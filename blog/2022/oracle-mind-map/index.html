<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.68.3" />

    
    
    

<title>Oracle Mind Map • Phil&#39;s Blog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Oracle Mind Map"/>
<meta name="twitter:description" content="Table Of Contents  Data Types  General Notes Mapping Between SQL, PL/SQL and C# Numeric Types  NUMBER (SQL Type) INTEGER PLS_INTEGER, BINARY_INTEGER and SIMPLE_INTEGER (PL/SQL only) BINARY_FLOAT and BINARY_DOUBLE (SQL Type) Working With Numbers   Character Types  Working With Strings Regular Expressions   Data and Time Types  Data and Time Conversions and Formatting Date and Timestamp Literals Current Date and Time Interval Types Extracting Date Components Datetime Arithmetic   Other Types SubTypes   Record Types Collections  Associative Arrays VARRAYs Nested Tables Collection Methods   Using Collections for Bulk Operations Variable and Constant Declarations Block Structure Loops Exceptions  Raising Custom Exceptions Error Built-ins   Useful System Views Using RowIds Query Plans URI Types and Network Access from within the DB Rights Models Oracle SQL  Sequences Cursor Attributes   Returning Clauses  Transactions   Cursors (for Data Retrieval)  Definitions Cursor Attributes Cursor Declarations Cursor Usage Cursors - Locking Rows with FOR UPDATE Cursors - Avoiding using ROWIDs and Primary Key clauses Cursors - Cursor Variables and Reference Cursors Cursor Expressions   Functions and Procedures  Table functions Pipelined functions (SEE ALSO CHAPTER 21) Parallel Functions Deterministic Functions DIsplaying Cursors (TSQL style)   Packages  Hiding of implementation details Initialization    Official Oracle Documentation  Oracle 21c Development Oracle 21c PL/SQL Language Reference Oracle 21c SQL Language Reference Oracle 21c SQL Language Quick Reference All Oracle SQL Functions  Data Types General Notes  Summary of PL/SQL Data Built-in Data Types PLS_INTEGER is highly efficient and should be used for all integer calculations."/>

<meta property="og:title" content="Oracle Mind Map" />
<meta property="og:description" content="Table Of Contents  Data Types  General Notes Mapping Between SQL, PL/SQL and C# Numeric Types  NUMBER (SQL Type) INTEGER PLS_INTEGER, BINARY_INTEGER and SIMPLE_INTEGER (PL/SQL only) BINARY_FLOAT and BINARY_DOUBLE (SQL Type) Working With Numbers   Character Types  Working With Strings Regular Expressions   Data and Time Types  Data and Time Conversions and Formatting Date and Timestamp Literals Current Date and Time Interval Types Extracting Date Components Datetime Arithmetic   Other Types SubTypes   Record Types Collections  Associative Arrays VARRAYs Nested Tables Collection Methods   Using Collections for Bulk Operations Variable and Constant Declarations Block Structure Loops Exceptions  Raising Custom Exceptions Error Built-ins   Useful System Views Using RowIds Query Plans URI Types and Network Access from within the DB Rights Models Oracle SQL  Sequences Cursor Attributes   Returning Clauses  Transactions   Cursors (for Data Retrieval)  Definitions Cursor Attributes Cursor Declarations Cursor Usage Cursors - Locking Rows with FOR UPDATE Cursors - Avoiding using ROWIDs and Primary Key clauses Cursors - Cursor Variables and Reference Cursors Cursor Expressions   Functions and Procedures  Table functions Pipelined functions (SEE ALSO CHAPTER 21) Parallel Functions Deterministic Functions DIsplaying Cursors (TSQL style)   Packages  Hiding of implementation details Initialization    Official Oracle Documentation  Oracle 21c Development Oracle 21c PL/SQL Language Reference Oracle 21c SQL Language Reference Oracle 21c SQL Language Quick Reference All Oracle SQL Functions  Data Types General Notes  Summary of PL/SQL Data Built-in Data Types PLS_INTEGER is highly efficient and should be used for all integer calculations." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.philipdaniels.com/blog/2022/oracle-mind-map/" />
<meta property="article:published_time" content="2022-07-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-20T00:00:00+00:00" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/gruvbox-dark.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.328a08e64c91c64b1af9c913a417dacec4e78f52fc75317d3ca3aececc1e2290.css" integrity="sha256-MooI5kyRxksa&#43;ckTpBfazsTnj1L8dTF9PKOuzsweIpA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/favicon-128.png" sizes="128x128" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/mstile-310x310.png" />

    

    
        
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QK1BLJ71TN');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QK1BLJ71TN"></script>
    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.philipdaniels.com/">Phil&#39;s Blog</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/5f3e5fe7d6a4062ad188336e06f1cb78?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Phil&#39;s Blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/gitcheatsheet">
						<span>My Git CheatSheet</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/PhilipDaniels" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://stackoverflow.com/users/1313057/philip-daniels" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="mailto:philip.daniels1971@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2023 Philip Daniels
  
</div>



  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Oracle Mind Map</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jul 20, 2022
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/oracle">oracle</a>
           
      
          <a class="badge badge-tag" href="/tags/pl/sql">pl/sql</a>
           
      
          <a class="badge badge-tag" href="/tags/sql">sql</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 31 min read
</div>


  </header>
  
  
  <div class="post">
    <h2 id="table-of-contents">Table Of Contents</h2>
<ul>
<li><a href="#data-types">Data Types</a>
<ul>
<li><a href="#general-notes">General Notes</a></li>
<li><a href="#mapping-between-sql-plsql-and-c">Mapping Between SQL, PL/SQL and C#</a></li>
<li><a href="#numeric-types">Numeric Types</a>
<ul>
<li><a href="#number-sql-type">NUMBER (SQL Type)</a></li>
<li><a href="#integer">INTEGER</a></li>
<li><a href="#pls_integer-binary_integer-and-simple_integer-plsql-only">PLS_INTEGER, BINARY_INTEGER and SIMPLE_INTEGER (PL/SQL only)</a></li>
<li><a href="#binary_float-and-binary_double-sql-type">BINARY_FLOAT and BINARY_DOUBLE (SQL Type)</a></li>
<li><a href="#working-with-numbers">Working With Numbers</a></li>
</ul>
</li>
<li><a href="#character-types">Character Types</a>
<ul>
<li><a href="#working-with-strings">Working With Strings</a></li>
<li><a href="#regular-expressions">Regular Expressions</a></li>
</ul>
</li>
<li><a href="#data-and-time-types">Data and Time Types</a>
<ul>
<li><a href="#data-and-time-conversions-and-formatting">Data and Time Conversions and Formatting</a></li>
<li><a href="#date-and-timestamp-literals">Date and Timestamp Literals</a></li>
<li><a href="#current-date-and-time">Current Date and Time</a></li>
<li><a href="#interval-types">Interval Types</a></li>
<li><a href="#extracting-date-components">Extracting Date Components</a></li>
<li><a href="#datetime-arithmetic">Datetime Arithmetic</a></li>
</ul>
</li>
<li><a href="#other-types">Other Types</a></li>
<li><a href="#subtypes">SubTypes</a></li>
</ul>
</li>
<li><a href="#record-types">Record Types</a></li>
<li><a href="#collections">Collections</a>
<ul>
<li><a href="#associative-arrays">Associative Arrays</a></li>
<li><a href="#varrays">VARRAYs</a></li>
<li><a href="#nested-tables">Nested Tables</a></li>
<li><a href="#collection-methods">Collection Methods</a></li>
</ul>
</li>
<li><a href="#using-collections-for-bulk-operations">Using Collections for Bulk Operations</a></li>
<li><a href="#variable-and-constant-declarations">Variable and Constant Declarations</a></li>
<li><a href="#block-structure">Block Structure</a></li>
<li><a href="#loops">Loops</a></li>
<li><a href="#exceptions">Exceptions</a>
<ul>
<li><a href="#raising-custom-exceptions">Raising Custom Exceptions</a></li>
<li><a href="#error-built-ins">Error Built-ins</a></li>
</ul>
</li>
<li><a href="#useful-system-views">Useful System Views</a></li>
<li><a href="#using-rowids">Using RowIds</a></li>
<li><a href="#query-plans">Query Plans</a></li>
<li><a href="#uri-types-and-network-access-from-within-the-db">URI Types and Network Access from within the DB</a></li>
<li><a href="#rights-models">Rights Models</a></li>
<li><a href="#oracle-sql">Oracle SQL</a>
<ul>
<li><a href="#sequences">Sequences</a></li>
<li><a href="#cursor-attributes">Cursor Attributes</a></li>
</ul>
</li>
<li><a href="#returning-clauses">Returning Clauses</a>
<ul>
<li><a href="#transactions">Transactions</a></li>
</ul>
</li>
<li><a href="#cursors-for-data-retrieval">Cursors (for Data Retrieval)</a>
<ul>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#cursor-attributes-1">Cursor Attributes</a></li>
<li><a href="#cursor-declarations">Cursor Declarations</a></li>
<li><a href="#cursor-usage">Cursor Usage</a></li>
<li><a href="#cursors---locking-rows-with-for-update">Cursors - Locking Rows with FOR UPDATE</a></li>
<li><a href="#cursors---avoiding-using-rowids-and-primary-key-clauses">Cursors - Avoiding using ROWIDs and Primary Key clauses</a></li>
<li><a href="#cursors---cursor-variables-and-reference-cursors">Cursors - Cursor Variables and Reference Cursors</a></li>
<li><a href="#cursor-expressions">Cursor Expressions</a></li>
</ul>
</li>
<li><a href="#functions-and-procedures">Functions and Procedures</a>
<ul>
<li><a href="#table-functions">Table functions</a></li>
<li><a href="#pipelined-functions-see-also-chapter-21">Pipelined functions (SEE ALSO CHAPTER 21)</a></li>
<li><a href="#parallel-functions">Parallel Functions</a></li>
<li><a href="#deterministic-functions">Deterministic Functions</a></li>
<li><a href="#displaying-cursors-tsql-style">DIsplaying Cursors (TSQL style)</a></li>
</ul>
</li>
<li><a href="#packages">Packages</a>
<ul>
<li><a href="#hiding-of-implementation-details">Hiding of implementation details</a></li>
<li><a href="#initialization">Initialization</a></li>
</ul>
</li>
</ul>
<h2 id="official-oracle-documentation">Official Oracle Documentation</h2>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/development.html">Oracle 21c Development</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/index.html">Oracle 21c PL/SQL Language Reference</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/index.html">Oracle 21c SQL Language Reference</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlqr/index.html">Oracle 21c SQL Language Quick Reference</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlqr/SQL-Functions.html#GUID-6E9F72DE-6939-4A15-8EB8-B833CBE8733C">All Oracle SQL Functions</a></li>
</ul>
<h1 id="data-types">Data Types</h1>
<h2 id="general-notes">General Notes</h2>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-predefined-data-types.html#GUID-1D28B7B6-15AE-454A-8134-F8724551AE8B">Summary of PL/SQL Data Built-in Data Types</a></li>
<li><code>PLS_INTEGER</code> is highly efficient and should be used for all integer calculations.</li>
<li>For virtually every data type there is a corresponding <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Single-Row-Functions.html#GUID-0E5115DD-F906-4F04-BB70-DF62DD4BBF91">TO_datatype</a>
function for performing conversions to it, in particular <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_NUMBER.html#GUID-D4807212-AFD7-48A7-9AED-BEC3E8809866">TO_NUMBER</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_CHAR-number.html#GUID-00DA076D-2468-41AB-A3AC-CC78DBA0D9CB">TO_CHAR</a>.</li>
</ul>
<h2 id="mapping-between-sql-plsql-and-c">Mapping Between SQL, PL/SQL and C#</h2>
<p>TODO!!!!!</p>
<h2 id="numeric-types">Numeric Types</h2>
<h3 id="number-sql-type">NUMBER (SQL Type)</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-75209AF6-476D-4C44-A5DC-5FA70D701B78">NUMBER(precision, scale)</a> can be used to represent ints, fixed-point (scale and precision) and floating point.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">    salary NUMBER(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">2</span>);    <span style="color:#75715e">-- fixed point
</span><span style="color:#75715e"></span>    multiplier NUMBER;     <span style="color:#75715e">-- decimal floating point, up to 40 digits
</span><span style="color:#75715e"></span>    num_weeks NUMBER(<span style="color:#ae81ff">3</span>);   <span style="color:#75715e">-- integer, 3 digits, same as NUMBER(3,0)
</span></code></pre></div><p>The <code>scale</code> can actually be greater than the <code>precision</code> and can even be negative, but if you have a need for that you probably should go home and reconsider your life.</p>
<p>For creating equivalents of C#/SQL Server types, try these, though their ranges are in fact larger, e.g. <code>NUMBER(3)</code> allows for -999 to 999.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">NUMBER(<span style="color:#ae81ff">3</span>)       <span style="color:#75715e">-- bytes
</span><span style="color:#75715e"></span>NUMBER(<span style="color:#ae81ff">5</span>)       <span style="color:#75715e">-- shorts (2 bytes in C#)
</span><span style="color:#75715e"></span>NUMBER(<span style="color:#ae81ff">10</span>)      <span style="color:#75715e">-- ints (4 bytes in C#)
</span><span style="color:#75715e"></span>NUMBER(<span style="color:#ae81ff">20</span>)      <span style="color:#75715e">-- longs (8 bytes in C#)
</span></code></pre></div><h3 id="integer">INTEGER</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-0BC16006-32F1-42B1-B45E-F27A494963FF">INTEGER</a> is a subtype of <code>NUMBER</code>, defined as <code>NUMBER(38)</code>. It is recommended for integer calculations that exceed the range of a <code>PLS_INTEGER</code>.</p>
<h3 id="pls_integer-binary_integer-and-simple_integer-plsql-only">PLS_INTEGER, BINARY_INTEGER and SIMPLE_INTEGER (PL/SQL only)</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-9517B7AC-9CEA-4C36-A454-52588BEEBE8F">PLS_INTEGER</a> is hardware-implemented 32-bit signed integer type. It is used for for FOR loop indexes. <code>BINARY_INTEGER</code> is a synonym for <code>PLS_INTEGER</code>, but is deprecated - use PLS_INTEGER instead.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-84C413B0-BDCA-4ABC-B402-3B8CED013DAF">SIMPLE_INTEGER</a> is a subtype of PLS_INTEGER that does not allow NULLs.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-00859F04-85FC-422D-B35B-93F5B5F4B912">There are several other</a> subtypes of <code>PLS_INTEGER</code>, with the ranges you would expect, e.g. <code>POSITIVE</code>.</p>
<h3 id="binary_float-and-binary_double-sql-type">BINARY_FLOAT and BINARY_DOUBLE (SQL Type)</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-F579F4B8-EF13-4CAF-9B06-03B076861C41">These types</a>
are 32 and 64 bit floating point numbers which map to the IEEE754 standard (i.e. they are hardware supported).</p>
<h3 id="working-with-numbers">Working With Numbers</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/CEIL.html#GUID-6DCC9AFB-9B80-4C27-AF63-5AA3B1E43660">CEIL</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/FLOOR.html#GUID-67F61AC7-C097-4397-A122-213157BF584F">FLOOR</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/ROUND-number.html#GUID-849F6C45-0D72-4464-9C0F-8B6822BA85E1">ROUND</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TRUNC-number.html#GUID-911AE7FE-E04A-471D-8B0E-9C50EBEFE07D">TRUNC</a> work as you would expect:
<img src="oracle_numeric_functions.png" alt="Rounding and Truncation"></p>
<p>There is also (as well as the usual assortment or trig functions):</p>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SIGN.html#GUID-08B75521-B5F5-4658-A005-4B4441C82945">SIGN(n)</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SQRT.html#GUID-E28C0B65-AAD8-4077-A82E-2FB4CD261CCA">SQRT(n)</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/POWER.html#GUID-D280B322-D2C3-46D0-8076-C88F16CBEDC2">POWER(n, pwr)</a> <code>n</code> and <code>pwr</code> do not need to be integers</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/MOD.html#GUID-E12A3928-2C50-45B0-B8C3-82432C751B8C">MOD(n,m)</a> remainder of <code>n</code> divided by <code>m</code>.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LOG.html#GUID-3739F356-A4A0-4D0D-A4EB-9725ACA05CD1">LOG(base, n)</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LN.html#GUID-DCC9EDAA-D308-4145-8E05-8D06A5EF5F6F">LN(n)</a></li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LEAST.html#GUID-0198D71B-051A-41D9-8E9C-599E24692556">LEAST(n1, n2, n3&hellip;)</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/GREATEST.html#GUID-06B88B22-8466-44B6-93C7-50B222122ECE">GREATEST(n1, n2, n3&hellip;)</a> these also work on strings</li>
</ul>
<h2 id="character-types">Character Types</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-85E0A0DD-9E90-4AE1-9AD5-93C89FDCFC49">char</a>
and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-0DC7FFAA-F03F-4448-8487-F2592496A510">varchar2</a> (up to 32,767 bytes). Also their <code>nchar</code> and <code>nvarchar2</code> variants.</p>
<h3 id="working-with-strings">Working With Strings</h3>
<ul>
<li>String indexes are 1-based!</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LENGTH.html#GUID-8F97F652-5AE8-4457-AFD7-7A6F25551E0C">LENGTH(str)</a> returns the length in <em>characters</em>: for ASCII this will be the same as <code>LENGTHB</code> (length in bytes).</li>
<li>Perform case conversion with <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/UPPER.html#GUID-0518FB26-7FE5-43B9-AB31-9352F9F6029C">UPPER(str)</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LOWER.html#GUID-C8682D4C-9BED-48AC-B73A-1D70BF307F48">LOWER(str)</a>.</li>
<li>There&rsquo;s <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/INITCAP.html#GUID-9FE9E0EE-D6B6-4C2C-BDEF-4FF4E1314560">INITCAP(str)</a> and it sometimes works correctly&hellip;</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/INSTR.html#GUID-47E3A7C4-ED72-458D-A1FA-25A9AD3BE113">INSTR(haystack, needle [,pos] [,occur])</a> returns the index of the needle in the haystack, or 0 if not found. <code>needle</code> can be a string, not just a char. <code>pos</code> specifies the start position, and <code>occur</code> specifies which occurence to return. If <code>pos</code> is negative, start at the end and <em>search backwards</em> (note that this behaviour differs slightly from <code>SUBSTR</code>, which goes <em>forwards</em> from its negative starting position).</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SUBSTR.html#GUID-C8A20B57-C647-4649-A379-8651AA97187E">SUBSTR(str, pos [,len])</a> Returns a substring of length <code>len</code> from <code>str</code>. Strangely, <code>pos</code> can be 0, in which case it is treated as 1! If <code>len</code> is omitted, go to the end of the <code>str</code>. If <code>pos</code> is negative, count backwards from the end to find the start position and then go forward from there.</li>
<li>There is no LEFT and RIGHT function, but <code>LEFT(str, len) = SUBSTR(str, 1, len)</code> and <code>RIGHT(str, len) = SUBSTR(str, -len)</code></li>
<li><a href="">LPAD(str, len [, pad_str])</a> and <a href="">RPAD(str, len [, pad_str])</a> do what you expect. If the <code>str</code> is longer than <code>len</code> then it is trimmed down to <code>len</code>. <code>pad_str</code> can be a single character or a string, and if omitted defaults to space.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LTRIM.html#GUID-81B3D53C-0BBC-4485-B057-C8012CD6E40F">LTRIM(str [,chars_to_trim])</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/RTRIM.html#GUID-95A7DAFB-F7AB-48F4-BE24-64B3C7A840AA">RTRIM(str [,chars_to_trim])</a> work as expected. If <code>chars_to_trim</code> is absent, spaces are trimmed.</li>
<li>There is a <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TRIM.html#GUID-00D5C77C-19B1-4894-828F-066746235B03">TRIM</a> function, but it is NOT equivalent to <code>LTRIM(RTRIM(str))</code> in most cases, though where the character to be trimmed is spaces, the shown call is correct.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TRANSLATE.html#GUID-80F85ACB-092C-4CC7-91F6-B3A585E3A690">TRANSLATE(str, charset, replacement_charset)</a> is the Oracle equivalent of Unix <code>tr</code>.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#75715e">-- nvarchar via the &#39;n&#39; prefix
</span><span style="color:#75715e"></span>vGerman :<span style="color:#f92672">=</span> n<span style="color:#e6db74">&#39;Straße&#39;</span>;

<span style="color:#66d9ef">UPPER</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>);       <span style="color:#75715e">-- &#39;HELLO WORLD&#39;
</span><span style="color:#75715e"></span>INITCAP(<span style="color:#e6db74">&#39;hello world&#39;</span>);       <span style="color:#75715e">-- &#39;Hello World&#39;
</span><span style="color:#75715e"></span>
INSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>);          <span style="color:#75715e">-- 5
</span><span style="color:#75715e"></span>INSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#ae81ff">6</span>);      <span style="color:#75715e">-- 8
</span><span style="color:#75715e"></span>INSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>);  <span style="color:#75715e">-- 8
</span><span style="color:#75715e"></span>INSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);      <span style="color:#75715e">-- 8 (searching backwards from the end)
</span><span style="color:#75715e"></span>INSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>);  <span style="color:#75715e">-- 5 (searching backwards from the end)
</span><span style="color:#75715e"></span>
SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">0</span>);         <span style="color:#75715e">-- &#39;hello world&#39;
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">1</span>);         <span style="color:#75715e">-- &#39;hello world&#39;
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>);    <span style="color:#75715e">-- &#39;hel&#39;, i.e. LEFT(str, 3)
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">2</span>);       <span style="color:#75715e">-- &#39;ello world&#39;
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>);   <span style="color:#75715e">-- &#39;ell&#39;
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>);      <span style="color:#75715e">-- &#39;rld&#39;, i.e. RIGHT(str, 3)
</span><span style="color:#75715e"></span>SUBSTR(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>);   <span style="color:#75715e">-- &#39;wor&#39; (5 back from the end, then 3)
</span><span style="color:#75715e"></span>
LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">8</span>);               <span style="color:#75715e">-- &#39;   hello&#39;
</span><span style="color:#75715e"></span>LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">3</span>);               <span style="color:#75715e">-- &#39;hel&#39;
</span><span style="color:#75715e"></span>LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;.&#39;</span>);          <span style="color:#75715e">-- &#39;...hello&#39;
</span><span style="color:#75715e"></span>LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;-=&#39;</span>);      <span style="color:#75715e">-- &#39;-=-hello&#39;
</span><span style="color:#75715e"></span>
RPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">3</span>);               <span style="color:#75715e">-- &#39;hel&#39;
</span><span style="color:#75715e"></span>
LTRIM(<span style="color:#e6db74">&#39;   hello   &#39;</span>);               <span style="color:#75715e">-- &#39;hello   &#39;
</span><span style="color:#75715e"></span>RTRIM(LTRIM(<span style="color:#e6db74">&#39;   hello   &#39;</span>));    <span style="color:#75715e">-- &#39;hello&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">TRIM</span>(<span style="color:#e6db74">&#39;   hello   &#39;</span>);                <span style="color:#75715e">-- &#39;hello&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">BOTH</span> <span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;===hello===&#39;</span>);              <span style="color:#75715e">-- &#39;hello&#39;
</span><span style="color:#75715e"></span>LTRIM(<span style="color:#e6db74">&#39;   123hello99&#39;</span>, <span style="color:#e6db74">&#39; 1234567890&#39;</span>);     <span style="color:#75715e">-- &#39;hello99&#39;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">TRANSLATE</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#e6db74">&#39;ld&#39;</span>, <span style="color:#e6db74">&#39;LD&#39;</span>);   <span style="color:#75715e">-- &#39;heLLo worLD&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">TRANSLATE</span>(<span style="color:#e6db74">&#39;12hello 34world&#39;</span>, <span style="color:#e6db74">&#39;x12345&#39;</span>, <span style="color:#e6db74">&#39;x&#39;</span>);   <span style="color:#75715e">-- &#39;hello world&#39; (trick to remove chars, in this case digits, by translating them to empty spaces)
</span></code></pre></div><h3 id="regular-expressions">Regular Expressions</h3>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Pattern-matching-Conditions.html#GUID-D2124F3A-C6E4-4CCA-A40E-2FFCABFD8E19">REGEXP_LIKE</a> - boolean test to see if a pattern matches.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/REGEXP_COUNT.html#GUID-5148AF2E-9CED-497D-A78D-3A7847A45276">REGEXP_COUNT</a> - count how many times a pattern matches</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/REGEXP_INSTR.html#GUID-D21B53A1-83E2-4722-9BBB-638470715DD6">REGEXP_INSTR</a> - return the char index of pattern match</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/REGEXP_SUBSTR.html#GUID-2903904D-455F-4839-A8B2-1731EF4BD099">REGEXP_SUBSTR</a> - return the text matching the pattern</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/REGEXP_REPLACE.html#GUID-EA80A33C-441A-4692-A959-273B5A224490">REGEXP_REPLACE</a> - replace matched text with new text (only one piece of new text can be specified)</li>
</ul>
<h2 id="data-and-time-types">Data and Time Types</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-5405B652-C30E-4F4F-9D33-9A4CB2110F1B">DATE</a> stores dates and times down to the second.
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-94A82966-D380-4583-9AF1-AEE681881E64">TIMESTAMP(n)</a> goes down to <code>n</code> fractions of a second. <code>n</code> defaults to 6.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-BE23545B-469A-4A57-8D13-505F2F5DB706">TIMESTAMP WITH TIME ZONE</a>
includes a specific timezone in its value. The offset is the difference between the timezone and UTC.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-E7CA339A-2093-4FE4-A36E-1D09593591D3">TIMESTAMP WITH LOCAL TIME ZONE</a>
stores data normalized to the database system&rsquo;s timezone.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-ED59E1B3-BA8D-4711-B5C8-B0199C676A95">INTERVAL YEAR TO MONTH(year_precision)</a> stores a <em>period of time</em> down to month precision, e.g. &ldquo;3 years and 2 months&rdquo;. It is useful for specifying differences between datetime values.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-B03DD036-66F8-4BD3-AF26-6D4433EBEC1C">INTERVAL DAY (day_precision) TO SECOND (fractional_seconds_precision)</a> stores a <em>period of time</em> in terms of days, hours, minutes and (fractional) seconds. It is useful for precise datetime differences.</p>
<h3 id="data-and-time-conversions-and-formatting">Data and Time Conversions and Formatting</h3>
<p>It&rsquo;s always best to use the
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_DATE.html#GUID-D226FA7C-F7AD-41A0-BB1D-BD8EF9440118">TO_DATE</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_TIMESTAMP.html">TO_TIMESTAMP</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_TIMESTAMP_TZ.html#GUID-3999303B-89CA-4AA3-9817-458F36ADC9DC">TO_TIMESTAMP_TZ</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_UTC_TIMESTAMP_TZ.html#GUID-1728EE3E-EC0C-4FA8-B404-99C0A445CE82">TO_UTC_TIMESTAMP_TZ</a>
functions to do conversions from strings.</p>
<p>Formatting for all these date-time types is handled by
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_CHAR-datetime.html#GUID-0C3EEFD1-AE3D-452D-BF23-2FC95664E78F">TO_CHAR</a>.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Format-Models.html#GUID-49B32A81-0904-433E-B7FE-51606672183A">The Format Models</a> page describes the components within these format strings.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> TO_DATE(<span style="color:#e6db74">&#39;2022-03-07&#39;</span>, <span style="color:#e6db74">&#39;YYYY-MM-DD&#39;</span>) <span style="color:#66d9ef">FROM</span> DUAL;

<span style="color:#66d9ef">SELECT</span> TO_DATE(<span style="color:#e6db74">&#39;07-SEP-2022&#39;</span>, <span style="color:#e6db74">&#39;DD-MON-YYYY&#39;</span>) <span style="color:#66d9ef">FROM</span> DUAL;

<span style="color:#66d9ef">SELECT</span> TO_TIMESTAMP (<span style="color:#e6db74">&#39;10-Sep-02 14:10:10.123000&#39;</span>, <span style="color:#e6db74">&#39;DD-Mon-RR HH24:MI:SS.FF&#39;</span>) <span style="color:#66d9ef">FROM</span> DUAL;
</code></pre></div><p>To roundtrip dates and timestamps USE xxxx.</p>
<h3 id="date-and-timestamp-literals">Date and Timestamp Literals</h3>
<p>You can declare DATE and TIMESTAMPs using literal syntax. The formats are fixed by the ISO standard (i.e. they don&rsquo;t care about NLS settings) so these are safe to use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">v1 :<span style="color:#f92672">=</span> DATE <span style="color:#e6db74">&#39;YYYY-MM-DD&#39;</span>
v2 :<span style="color:#f92672">=</span> <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#e6db74">&#39;YYYY-MM-DD HH:MI:SS[.FFFFFFFFFF] [{+|-}HH:MI]
</span></code></pre></div><h3 id="current-date-and-time">Current Date and Time</h3>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SYSDATE.html#GUID-807F8FC5-D72D-4F4D-B66D-B0FE1A8FA7D2">SYSDATE</a> and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SYSTIMESTAMP.html#GUID-FCED18CE-A875-4D5D-9178-3DE4FA956516">SYSTIMESTAMP</a> return the current date and timestamp ON THE SERVER. <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/CURRENT_DATE.html#GUID-96795097-D6F0-4288-90E7-9D7C49B4F6E5">CURRENT_DATE</a>,
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/CURRENT_TIMESTAMP.html#GUID-CBD42B84-869D-45C7-9FFC-001DD7712097">CURRENT_TIMESTAMP</a> and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/LOCALTIMESTAMP.html#GUID-3C3D1F29-5F53-41F2-B2D6-A3767DFB22CA">LOCAL_TIMESTAMP</a> return the current date and timestamp FOR YOUR SESSION.</p>
<p>To see your settings, query <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/DBTIMEZONE.html#GUID-F2368F72-7065-462F-80B9-E115F5A48025">DBTIMEZONE</a> and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SESSIONTIMEZONE.html#GUID-2A243878-C1C5-4B7C-81DE-D8B024796EAB">SESSION_TIMEZONE</a>.</p>
<h3 id="interval-types">Interval Types</h3>
<p>Some definitions:</p>
<ul>
<li>An <em>Instant</em> is a point in time. Represented by the DATE and TIMESTAMP types.</li>
<li>An <em>Interval</em> is an amount of time, such as &ldquo;8 days&rdquo;. There are two types to represent these, <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-ED59E1B3-BA8D-4711-B5C8-B0199C676A95">INTERVAL YEAR TO MONTH</a> and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-B03DD036-66F8-4BD3-AF26-6D4433EBEC1C">INTERVAL DAY TO SECOND</a>.</li>
<li>A <em>Period</em> is an interval that begins at a specific time - hence combining the above two definitions. There is no built-in Oracle support for these types.</li>
</ul>
<p>An interval is declared as one of these two types:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">var1 INTERVAL <span style="color:#66d9ef">YEAR</span> [(year_precision)] <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">MONTH</span>;
var2 INTERVAL <span style="color:#66d9ef">DAY</span> [(day_precision)] <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">SECOND</span> [(frac_sec_precision)];
</code></pre></div><p>See the links above for the precision limits.</p>
<p>You can convert numbers to the interval types using
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/NUMTOYMINTERVAL.html#GUID-B98B21AA-44F7-4A9D-A646-6775A1D5F46D">NUMTOYMINTERVAL</a> and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/NUMTODSINTERVAL.html#GUID-5A7392A8-7976-4465-8839-A65EFF1A80B6">NUMTODSINTERVAL</a>. To convert strings to intervals use <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_YMINTERVAL.html#GUID-5DEBA096-7AC3-4B18-A4BE-D36FC9BDB450">TO_YMINTERVAL</a> and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/TO_DSINTERVAL.html#GUID-DEBB41BD-9438-4558-A53E-428CE93C05D3">TO_DSINTERVAL</a>. You can also write interval literals using the same character formats, for example</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">v1 :<span style="color:#f92672">=</span> INTERVAL <span style="color:#e6db74">&#39;10-3&#39;</span> <span style="color:#66d9ef">YEAR</span> <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">MONTH</span>;
v2 :<span style="color:#f92672">=</span> INTERVAL <span style="color:#e6db74">&#39;4&#39;</span> <span style="color:#66d9ef">YEAR</span>;
v3 :<span style="color:#f92672">=</span> INTERVAL <span style="color:#e6db74">&#39;3 12:13:14.45&#39;</span> <span style="color:#66d9ef">DAY</span> <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">SECOND</span>;
V4 :<span style="color:#f92672">=</span> INTERVAL <span style="color:#e6db74">&#39;1:03&#39;</span> HOUR <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">MINUTE</span>;
</code></pre></div><h3 id="extracting-date-components">Extracting Date Components</h3>
<p>Use <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/EXTRACT-datetime.html#GUID-36E52BF8-945D-437D-9A3C-6860CABD210E">EXTRACT</a>. You can extract YEAR, MONTH, DAY, HOUR, MINUTE, SECOND and timezone bits.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXTRACT</span>(<span style="color:#66d9ef">MONTH</span> <span style="color:#66d9ef">FROM</span> SYSDATE) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">THEN</span>...
</code></pre></div><h3 id="datetime-arithmetic">Datetime Arithmetic</h3>
<p>For DATE values we can perform arithmetic thusly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">SYSDATE <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>                 <span style="color:#75715e">-- Add 1 day
</span><span style="color:#75715e"></span>SYSDATE <span style="color:#f92672">+</span> (<span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span>)            <span style="color:#75715e">-- Add 4 hours
</span><span style="color:#75715e"></span>SYSDATE <span style="color:#f92672">+</span> (<span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1440</span>)         <span style="color:#75715e">-- Add 12 minutes
</span><span style="color:#75715e"></span>SYSDATE <span style="color:#f92672">+</span> (<span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span><span style="color:#f92672">/</span><span style="color:#ae81ff">60</span>)            <span style="color:#75715e">-- Also add 12 minutes
</span><span style="color:#75715e"></span>SYSDATE <span style="color:#f92672">+</span> (<span style="color:#ae81ff">37</span><span style="color:#f92672">/</span><span style="color:#ae81ff">86400</span>)            <span style="color:#75715e">-- Add 37 seconds
</span><span style="color:#75715e"></span>SYSDATE <span style="color:#f92672">+</span> (<span style="color:#ae81ff">37</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span><span style="color:#f92672">/</span><span style="color:#ae81ff">60</span><span style="color:#f92672">/</span><span style="color:#ae81ff">60</span>)         <span style="color:#75715e">-- Also add 37 seconds
</span></code></pre></div><p>You can add an interval to a timestamp. Example using the interval literal format:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- Add 3 days, 4 hours and 30 minutes to the current time.
</span><span style="color:#75715e"></span>SYSTIMESTAMP <span style="color:#f92672">+</span> INTERVAL <span style="color:#e6db74">&#39;3 4:30&#39;</span> <span style="color:#66d9ef">DAY</span> <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">SECOND</span>;
</code></pre></div><p>This works OK for <code>DAY TO SECOND</code> but for <code>YEAR TO MONTH</code> it is problematic because of varying month lengths. You can use <a href="">ADD_MONTHS</a> to add or subtract whole months even when you are dealing with a day at the end of the month (it clamps the result to the end of month)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">end_of_may2008 :<span style="color:#f92672">=</span> TO_TIMESTAMP(<span style="color:#e6db74">&#39;31-MAY-2008&#39;</span>, <span style="color:#e6db74">&#39;DD-Mon-YYYY&#39;</span>);
next_month :<span style="color:#f92672">=</span> TO_TIMESTAMP(ADD_MONTHS(end_of_may2008, <span style="color:#ae81ff">1</span>));  <span style="color:#75715e">-- 30 June 2008.
</span></code></pre></div><p>If you subtract two <code>TIMESTAMPS</code> you get an <code>INTERVAL DAY TO SECOND</code> (always). The interval can be negative. On the other hand, if you subtract two <code>DATES</code> you get a <em>fractional</em> number
indicating the number of 24 hour periods they are apart.</p>
<p>If you mix <code>DATE</code> and <code>TIMESTAMP</code> expression Oracle will implicitly promote everything to <code>TIMESTAMP</code>. It is best to do this casting explicitly yourself.</p>
<p>You can add and subtract two intervals, and you can multiply an interval by a number.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DECLARE</span>
    vInterval INTERVAL <span style="color:#66d9ef">YEAR</span> <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">MONTH</span> :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2-10&#39;</span>;
<span style="color:#66d9ef">BEGIN</span>
    vInterval :<span style="color:#f92672">=</span> vInterval <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h4 id="misc-date-tricks">Misc Date Tricks</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- Truncate to minute resolution.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> TRUNC(SYSDATE, <span style="color:#e6db74">&#39;MI&#39;</span>) <span style="color:#66d9ef">FROM</span> DUAL;

<span style="color:#75715e">-- Generate dates by the minute.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>
    TRUNC(SYSDATE <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>)      <span style="color:#75715e">-- Start date, i.e. 3 days ago at 00:00
</span><span style="color:#75715e"></span>    <span style="color:#f92672">+</span> (<span style="color:#66d9ef">level</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">1440</span> <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">result</span>,
    <span style="color:#66d9ef">level</span>
<span style="color:#66d9ef">FROM</span> DUAL
<span style="color:#66d9ef">CONNECT</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">LEVEL</span> <span style="color:#f92672">&lt;=</span> (SYSDATE <span style="color:#f92672">-</span> TRUNC(SYSDATE <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1440</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">result</span>;
 
<span style="color:#75715e">-- Timing code.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DECLARE</span>
    vStartTime PLS_INTEGER;
<span style="color:#66d9ef">BEGIN</span>
  vStartTime :<span style="color:#f92672">=</span> DBMS_UTILITY.GET_TIME();
  <span style="color:#75715e">-- Code here
</span><span style="color:#75715e"></span>  DBMS_OUTPUT.PUT_LINE(<span style="color:#e6db74">&#39;Took &#39;</span> <span style="color:#f92672">||</span> (DBMS_UTILITY.GET_TIME() <span style="color:#f92672">-</span> vStartTime));
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="other-types">Other Types</h2>
<p>PL/SQL has a <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-02AEA63C-9A27-43F4-80B7-4781343445D0">Boolean Type</a> which supports NULLs, but it can&rsquo;t be used in tables, only in PL/SQL code. For tables, use <code>NUMBER(1)</code> or <code>CHAR(1)</code>.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-4231B94A-97E9-4B59-91EB-E7B2D0DA438C">ROWID</a> represents the address of a row. You can get it by selecting the pseudo-column <code>ROWID</code>. An update that uses ROWID in its where clause is guaranteed to update 1 row.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-4570CDFD-8F91-44B9-BE7F-13076AA2AEBF">BLOB</a>
and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-0EAC5929-0674-429C-AF42-2D454C982F8F">CLOB</a>
are for very long (up to 4GB) binary data and text, respectively. They should be used in preference to the deprecated
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Data-Types.html#GUID-4FD497DD-3331-4C25-9147-3CEBEFDBFF22">RAW and LONG RAW</a>.</p>
<h2 id="subtypes">SubTypes</h2>
<p>Subtypes can be created
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-FDC366F3-66AA-4F6A-A59B-5A08DCBD4F9F">constrained</a>
or <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-data-types.html#GUID-31F465A3-F8F7-413A-AB6F-7EF422D052E0">unconstrained</a>.
An unconstrained subtype is a way of making a type alias.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#75715e">-- Constrained
</span><span style="color:#75715e"></span>SUBTYPE SMALL <span style="color:#66d9ef">IS</span> BINARY_INTEGER RANGE <span style="color:#ae81ff">1</span>..<span style="color:#ae81ff">3</span>;
<span style="color:#75715e">-- Unconstrained
</span><span style="color:#75715e"></span>SUBTYPE FLOATY <span style="color:#66d9ef">IS</span> BINARY_FLOAT;
</code></pre></div><h1 id="record-types">Record Types</h1>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html">Record types</a> correspond to a row of a table or simply a tuple of data. They can be declared and used as follows</p>
<ul>
<li>Using <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/ROWTYPE-attribute.html#GUID-4E0B9FE2-909D-444A-9B4A-E0243B7FCB99">%ROWTYPE</a></li>
<li>Using <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/record-variable-declaration.html#GUID-704FC014-561E-422C-9636-EDCA3B996AAD">Type x IS RECORD ( &hellip; )</a></li>
<li>Using a cursor <code>%ROWTYPE</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#75715e">-- Table based, assuming a Books table
</span><span style="color:#75715e"></span>    vBook Books<span style="color:#f92672">%</span>ROWTYPE;        

    <span style="color:#75715e">-- Custom record type.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">TYPE</span> customRecord <span style="color:#66d9ef">IS</span> RECORD (   
        Id PLS_INTEGER,
        Name SomeTable.<span style="color:#66d9ef">Column</span>.<span style="color:#f92672">%</span><span style="color:#66d9ef">TYPE</span>
    );
    vCustom customRecord;

    <span style="color:#75715e">-- Cursor based record type.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DECLARE</span> curBooks <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> Books...;
    vMyBook curBooks<span style="color:#f92672">%</span>ROWTYPE;

    <span style="color:#75715e">-- Ref cursor.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">TYPE</span> booksRefCur <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">REF</span> <span style="color:#66d9ef">CURSOR</span> <span style="color:#66d9ef">RETURN</span> Books<span style="color:#f92672">%</span>ROWTYPE;
    vBooksCur booksRefCur;
    vOneBook vBooksCur<span style="color:#f92672">%</span>ROWTYPE;

    <span style="color:#75715e">-- Nested record type with default values.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">TYPE</span> CountyRecord <span style="color:#66d9ef">IS</span> RECORD ( ... );
    <span style="color:#66d9ef">TYPE</span> CountiesTable <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> CountyRecord <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">BY</span> BINARY_INTEGER;

    <span style="color:#66d9ef">TYPE</span> CountryRecord <span style="color:#66d9ef">IS</span> RECORD (
        ISOCode VARCHAR2(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UK&#39;</span>,
        CapitalCounty CountyRecord,     <span style="color:#75715e">-- Nest 1 record
</span><span style="color:#75715e"></span>        OtherCounties CountiesTable     <span style="color:#75715e">-- Nest an entire table
</span><span style="color:#75715e"></span>    );
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#75715e">-- Fetch one row
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">INTO</span> vBook ...
    <span style="color:#66d9ef">IF</span> vBook.Author <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Philip Daniels&#39;</span> <span style="color:#66d9ef">THEN</span> ...

    <span style="color:#75715e">-- Implicit record type from a for loop
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">FOR</span> vBookRec <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> Books) LOOP
        <span style="color:#75715e">-- Records have value semantics and can be copied, passed and
</span><span style="color:#75715e"></span>        <span style="color:#75715e">-- returned from procs and functions.
</span><span style="color:#75715e"></span>        vBackupBook :<span style="color:#f92672">=</span> vBookRec;

        <span style="color:#75715e">-- Can insert entire rows. Note lack of parentheses.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> BackupBooks <span style="color:#66d9ef">VALUES</span> vBackupBook;

        <span style="color:#75715e">-- Updates of entire rows use the &#39;ROW&#39; keyword.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">UPDATE</span> SecondBackups <span style="color:#66d9ef">SET</span>
            <span style="color:#66d9ef">ROW</span> <span style="color:#f92672">=</span> vBackupBook
        <span style="color:#66d9ef">WHERE</span>
            Id <span style="color:#f92672">=</span> vBackupBook.Id;

        <span style="color:#75715e">-- Records can also be used in RETURNING clauses, but you must
</span><span style="color:#75715e"></span>        <span style="color:#75715e">-- individually name each field. This also works for BULK COLLECT INTO.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">UPDATE</span> SecondBackups <span style="color:#66d9ef">SET</span>
            <span style="color:#66d9ef">ROW</span> <span style="color:#f92672">=</span> vBackupBook
        <span style="color:#66d9ef">WHERE</span>
            Id <span style="color:#f92672">=</span> vBackupBook.Id
        RETURNING col1, col2, col3...
        <span style="color:#66d9ef">INTO</span> vAdjustedBook;
    <span style="color:#66d9ef">END</span> LOOP

    <span style="color:#75715e">-- Records have constructors which you call like a function.
</span><span style="color:#75715e"></span>    vMyCounty :<span style="color:#f92672">=</span> CountryRecord(<span style="color:#e6db74">&#39;Y&#39;</span>J, <span style="color:#ae81ff">500000</span>, <span style="color:#e6db74">&#39;York&#39;</span>);
    
    <span style="color:#75715e">-- You can&#39;t do this, it doesn&#39;t work.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">IF</span> vMyRecordType <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">THEN</span>...
    <span style="color:#75715e">-- Instead, check a non-nullable field inside the record.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">IF</span> vMyRecordType.Id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">THEN</span>...
<span style="color:#66d9ef">END</span>
</code></pre></div><ul>
<li>You can set all the fields of a record to NULL by assigning NULL to the record variable.</li>
<li>You cannot compare entire records for equality, you must do it field by field.</li>
<li>You can assign records of different types if the underlying fields are data-type compatible.</li>
<li>Records cannot have member functions, they only apply to <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/CREATE-TYPE.html#GUID-E72E3EE6-DE95-4F58-8941-E2F76D0EAE80">object types</a>. Object types must be defined at the SQL-level.</li>
</ul>
<p>For information of passing records and collections of records to and from C#, see
<a href="https://www.philipdaniels.com/blog/2021/oracle-from-csharp/">this blog post about my Helpers for Calling Oracle</a>.</p>
<h1 id="collections">Collections</h1>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-7E9034D5-0D33-43A1-9012-918350FE148C">Collections</a> are containers which are indexed by an integer or a string. Each entry in the container is either a primitive type or an aggregate such as a record type. There are three
types of collections</p>
<table>
<thead>
<tr>
<th>Type</th>
<th align="center">Index By</th>
<th align="center">Fixed Size?</th>
<th align="center">Sparse?</th>
<th align="center">PLSQL/DB?</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#associative-arrays">Associative arrays</a></td>
<td align="center">INT, STR</td>
<td align="center">No</td>
<td align="center">Sparse</td>
<td align="center">PLSQL</td>
</tr>
<tr>
<td><a href="#varrays">VARRAYs</a></td>
<td align="center">NT</td>
<td align="center">Yes</td>
<td align="center">Dense</td>
<td align="center">PLSQL, DB</td>
</tr>
<tr>
<td><a href="#nested-tables">Nested tables</a></td>
<td align="center">INT</td>
<td align="center">No</td>
<td align="center">Sparse</td>
<td align="center">PLSQL, DB</td>
</tr>
</tbody>
</table>
<p>For information about passing records and collections of records to and from C#, see
<a href="https://www.philipdaniels.com/blog/2021/oracle-from-csharp/">this blog post about my Helpers for Calling Oracle</a>.</p>
<h2 id="associative-arrays">Associative Arrays</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-8060F01F-B53B-48D4-9239-7EA8461C2170">Associative arrays</a> are also known as &lsquo;index-by tables&rsquo; because they can be indexed by strings or integers. They are like hashmaps in other programming languages.</p>
<p><em><strong>Associative arrays cannot be manipulated with SQL DML statements</strong></em>.</p>
<p>They are useful for passing arrays of records to and from the database server, see <a href="#using-collections-for-bulk-operations">BULK OPERATIONS</a> for examples.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#75715e">-- You can use &#39;INDEX BY tbl.col%TYPE&#39;
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">TYPE</span> PersonTable <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> Person<span style="color:#f92672">%</span>ROWTYPE <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">BY</span> PLS_INTEGER;
    vPeople PersonTable;
    vIdx PLS_INTEGER;
<span style="color:#66d9ef">BEGIN</span>
    vPeople(<span style="color:#ae81ff">1212</span>).FirstName :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Philip&#39;</span>;
    vPeople(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>).FirstName :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Zaphod&#39;</span>;

    vIdx <span style="color:#f92672">=</span> vPeople.<span style="color:#66d9ef">FIRST</span>;
    WHILE (vIdx <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>) LOOP
        ...
        vIdx <span style="color:#f92672">=</span> vPeople.<span style="color:#66d9ef">NEXT</span>(vIdx);
    <span style="color:#66d9ef">END</span> LOOP;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="varrays">VARRAYs</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-E932FC04-C7AD-4562-9555-8BA05446C0B8">VARRAYs</a> are arrays whose number of elements can vary from zero (empty) to the declared maximum size.</p>
<p>VARRAYs are rather inflexible because you must set or get all elements at the same time. However, they do preserve the order of their elements.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> Foursome <span style="color:#66d9ef">IS</span> VARRAY(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">OF</span> VARCHAR2(<span style="color:#ae81ff">15</span>);
    team Foursome :<span style="color:#f92672">=</span> Foursome();  <span style="color:#75715e">-- initialize to empty by calling ctor
</span><span style="color:#75715e"></span>    team :<span style="color:#f92672">=</span> Foursome(<span style="color:#e6db74">&#39;John&#39;</span>, <span style="color:#e6db74">&#39;Mary&#39;</span>, <span style="color:#e6db74">&#39;Alberto&#39;</span>, <span style="color:#e6db74">&#39;Juanita&#39;</span>); <span style="color:#75715e">-- Initialize each element
</span></code></pre></div><h2 id="nested-tables">Nested Tables</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-5ADB7EE2-71F6-4172-ACD8-FFDCF2787A37">Nested Tables</a> is a database column type that stores a variable number of rows in no particular order (i.e. it behaves like a normal table would). The syntax for declaring them is similar to that for associative arrays, but it lacks the <code>INDEX BY</code> clause. Constructors are similar to those for VARRAYs, but</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> Roster <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> VARCHAR2(<span style="color:#ae81ff">15</span>);
    vEmptyRoster :<span style="color:#f92672">=</span> Roster();
    vQuadRoster :<span style="color:#f92672">=</span> Roster(<span style="color:#e6db74">&#39;Ringo&#39;</span>, <span style="color:#e6db74">&#39;John&#39;</span>, <span style="color:#e6db74">&#39;Paul&#39;</span>, <span style="color:#e6db74">&#39;George&#39;</span>);
</code></pre></div><p>Nested tables can be defined as sub-tables in SQL by using the <code>CREATE TABLE () NESTED TABLE x STORE AS y</code> syntax. You can only access the nested table via the outer table, even though it is stored as a separate physical table in the database. To insert values,
use the constructor syntax.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TYPE</span> CourseList <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> VARCHAR2(<span style="color:#ae81ff">64</span>);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> department (
    name     VARCHAR2(<span style="color:#ae81ff">20</span>),
    director VARCHAR2(<span style="color:#ae81ff">20</span>),
    office   VARCHAR2(<span style="color:#ae81ff">20</span>),
    courses  CourseList) 
    NESTED <span style="color:#66d9ef">TABLE</span> courses STORE <span style="color:#66d9ef">AS</span> courses_tab;
</code></pre></div><h2 id="collection-methods">Collection Methods</h2>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-5700158F-FF45-4964-89B3-1EF614BA3B7D">COUNT</a> - return the number of elements</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-33E18BC6-C0A8-456B-A47C-A4504240D962">FIRST and LAST</a> - return the first (smallest) and last (largest) subscripts</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-31E27176-042B-4BA8-8FBC-14CCEDC33095">EXISTS</a> - boolean check for element existence</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-FB1216B3-2DC3-48D6-BCEC-243F995BFB09">PRIOR and NEXT</a> - get the prior or next subscript, for iteration</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-E43509F6-5044-4B17-9516-2EB4BDDD5173">DELETE</a> - remove 1 or more elements</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-6AF582B1-9C50-4858-AE6C-B14DD051ACD1">TRIM</a> - remove elements from the end</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-03F74821-BC33-4544-9304-5FBBE6EFE450">EXTEND</a> - increases the number of elements in a VARRAY or nested table</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-collections-and-records.html#GUID-1E0E1010-FFC5-4F4A-AD87-58BE9CE8146D">LIMIT</a> - returns the length of a VARRAY</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">IF</span> my_collection.<span style="color:#66d9ef">COUNT</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span>
    ...
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;

<span style="color:#66d9ef">FOR</span> idx <span style="color:#66d9ef">IN</span> my_collection.<span style="color:#66d9ef">FIRST</span> .. my_collection.<span style="color:#66d9ef">LAST</span> LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;

<span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> my_collection(<span style="color:#ae81ff">12</span>) <span style="color:#66d9ef">THEN</span>
    ...
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;

<span style="color:#75715e">-- Iterate forwards over non-contiguous keys. Use LAST/PRIOR to go backwards.
</span><span style="color:#75715e"></span>idx :<span style="color:#f92672">=</span> my_collection.<span style="color:#66d9ef">FIRST</span>;
LOOP
    EXIT <span style="color:#66d9ef">WHEN</span> idx <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;      <span style="color:#75715e">-- Termination condition
</span><span style="color:#75715e"></span>    <span style="color:#75715e">-- use my_collection(idx)
</span><span style="color:#75715e"></span>    idx :<span style="color:#f92672">=</span> my_collection.<span style="color:#66d9ef">NEXT</span>;
<span style="color:#66d9ef">END</span> LOOP;

my_collection.<span style="color:#66d9ef">DELETE</span>(idx);
my_collection.<span style="color:#66d9ef">DELETE</span>(i, j);  <span style="color:#75715e">-- delete i-th to j-th elements inclusive
</span><span style="color:#75715e"></span>my_collection.<span style="color:#66d9ef">DELETE</span>;        <span style="color:#75715e">-- delete all elements
</span><span style="color:#75715e"></span>
my_collection.<span style="color:#66d9ef">TRIM</span> ;     <span style="color:#75715e">-- remove one element from the end
</span><span style="color:#75715e"></span>my_collection.<span style="color:#66d9ef">TRIM</span>(<span style="color:#ae81ff">6</span>)   <span style="color:#75715e">-- remove 6 elements from the end
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- For nested tables and varrays you must reserve a slot with
</span><span style="color:#75715e">-- EXTEND before setting the new element. For associative arrays
</span><span style="color:#75715e">-- this is not needed (because they are like hashmaps).
</span><span style="color:#75715e"></span>my_collection.EXTEND;       <span style="color:#75715e">-- Add 1 NULL element
</span><span style="color:#75715e"></span>my_collection(my_collection.<span style="color:#66d9ef">LAST</span>) :<span style="color:#f92672">=</span> new_data;

my_collection.EXTEND(<span style="color:#ae81ff">5</span>);                <span style="color:#75715e">-- Add 5 new NULL elements
</span><span style="color:#75715e"></span>my_collection.EXTEND(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;hello&#39;</span>);     <span style="color:#75715e">-- Add 5 new elements with value &#39;hello&#39;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- LIMIT is used with VARRAYs only, to find the max number of elements allowed
</span><span style="color:#75715e"></span><span style="color:#66d9ef">IF</span> my_array.<span style="color:#66d9ef">LAST</span> <span style="color:#f92672">&lt;</span> my_array.<span style="color:#66d9ef">LIMIT</span> <span style="color:#66d9ef">THEN</span>
    my_array.EXTEND;
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
</code></pre></div><h1 id="using-collections-for-bulk-operations">Using Collections for Bulk Operations</h1>
<p>You can populate a collection <em>with 1 element</em> using a SELECT:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> col
<span style="color:#66d9ef">INTO</span> my_colors
<span style="color:#66d9ef">FROM</span>...
<span style="color:#66d9ef">WHERE</span> PK <span style="color:#f92672">=</span> ...
</code></pre></div><p>If you want to get more than 1 row, you need a <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/RETURNING-INTO-clause.html#GUID-38F735B9-1100-45AF-AE71-18FB74A899BE">BULK COLLECT</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
BULK COLLECT <span style="color:#66d9ef">INTO</span> vPeople [<span style="color:#66d9ef">LIMIT</span> n]
<span style="color:#66d9ef">FROM</span> Person
<span style="color:#66d9ef">WHERE</span> ...;
</code></pre></div><p>An optional <code>LIMIT</code> or <code>FETCH FIRST</code> clause allows you to limit the number of rows, this is useful for loops which process N
rows at a time, for example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">OPEN</span> vMyCur;

LOOP
    <span style="color:#66d9ef">FETCH</span> vMyCur
    BULK COLLECT <span style="color:#66d9ef">INTO</span> vEmployees
    <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">100</span>;
    EXIT <span style="color:#66d9ef">WHEN</span> vEmployees.<span style="color:#66d9ef">Count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    ...
<span style="color:#66d9ef">END</span> LOOP;

<span style="color:#66d9ef">CLOSE</span> vMyCur;
</code></pre></div><p>The above examples also shows how <code>BULK COLLECT</code>
can be used with an explicit cursor.</p>
<p>You can also collect multiple things simultaneously:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> FirstName, LastName
BULK COLLECT <span style="color:#66d9ef">INTO</span> vFirstNames, vLastNames
<span style="color:#66d9ef">FROM</span> People
</code></pre></div><p>You can use <code>BULK COLLECT</code> with a
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/RETURNING-INTO-clause.html">RETURNING</a>
clause to gather the changes that were made to multiple rows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">UPDATE</span> ...
<span style="color:#66d9ef">RETURN</span> ChangedColumn
BULK COLLECT <span style="color:#66d9ef">INTO</span> vChanges;
</code></pre></div><p>A collection variable can be passed to the <a href="">TABLE</a> function to produce
a virtual table which can be queried in a SELECT statement. For tables of
primitive types you can use the <code>COLUMN_VALUE</code> keyword to give a name
to the column.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">TYPE</span> NameTable <span style="color:#66d9ef">IS</span>
<span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> VARCHAR2(<span style="color:#ae81ff">200</span>);

<span style="color:#66d9ef">DECLARE</span>
    vNames NameTable :<span style="color:#f92672">=</span> NameTable();

<span style="color:#66d9ef">SELECT</span> COLUMN_VALUE my_name
<span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">TABLE</span>(vNames)
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> my_name;
</code></pre></div><p>If you are using a record or object type then you don&rsquo;t need <code>COLUMN_VALUE</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">TYPE</span> xxx <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">OBJECT</span>(x INT, y VARCHAR(<span style="color:#ae81ff">20</span>));
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">TYPE</span> xxxTable <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> xxx;

<span style="color:#66d9ef">DECLARE</span>   
  vX xxxTable :<span style="color:#f92672">=</span> xxxTable();
  a INT;
<span style="color:#66d9ef">BEGIN</span>
  vX.EXTEND(<span style="color:#ae81ff">2</span>);
  vX(<span style="color:#ae81ff">1</span>) :<span style="color:#f92672">=</span> xxx(<span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;ggg&#39;</span>);
  vX(<span style="color:#ae81ff">2</span>) :<span style="color:#f92672">=</span> xxx(<span style="color:#ae81ff">220</span>, <span style="color:#e6db74">&#39;dddddd&#39;</span>);
  
  <span style="color:#66d9ef">SELECT</span> x
  <span style="color:#66d9ef">INTO</span> a
  <span style="color:#66d9ef">FROM</span>
    <span style="color:#66d9ef">TABLE</span>(vX)
  <span style="color:#66d9ef">WHERE</span> y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ggg&#39;</span>;
  
  DBMS_OUTPUT.PUT_LINE(<span style="color:#e6db74">&#39;a = &#39;</span> <span style="color:#f92672">||</span> a);    <span style="color:#75715e">-- Prints 20
</span><span style="color:#75715e"></span><span style="color:#66d9ef">END</span>;
</code></pre></div><p>Note this <code>TABLE</code> example used schema-level types for simplicity. You can also
use <code>TABLE</code> with all 3 collection types if they are declared in a package specification, but you CAN&rsquo;T use <code>TABLE</code> with a locally declared collection type (such as in a <code>DECLARE</code> block at the beginning of a procedure).</p>
<h1 id="variable-and-constant-declarations">Variable and Constant Declarations</h1>
<p>Variable declarations:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">name datatype [<span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>] [ :<span style="color:#f92672">=</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DEFAULT</span> default_assignment ];

vName VARCHAR2(<span style="color:#ae81ff">255</span>);
vName2 VARCHAR2(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> :<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Zaphod&#39;</span>;
vName3 VARCHAR2(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;Arthur&#39;</span>; <span style="color:#75715e">-- Weird
</span><span style="color:#75715e"></span>vDate DATE :<span style="color:#f92672">=</span> SYSDATE;
</code></pre></div><p>Constant declarations:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">name CONSTANT datatype [<span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>] :<span style="color:#f92672">=</span> <span style="color:#66d9ef">DEFAULT</span> default_value;

cNow CONSTANT <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> :<span style="color:#f92672">=</span> SYSDATE;
cCurrentYear CONSTANT PLS_INTEGER :<span style="color:#f92672">=</span> TO_NUMBER(TO_CHAR(SYSDATE, <span style="color:#e6db74">&#39;YYYY&#39;</span>));
</code></pre></div><p>Type anchoring can be performed against table columns (using <code>%TYPE</code>) or entire tables or cursors (using <code>%ROWTYPE</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">vName PersonTable.NameColumn<span style="color:#f92672">%</span><span style="color:#66d9ef">TYPE</span>;
vPerson PersonTable<span style="color:#f92672">%</span>ROWTYPE;
</code></pre></div><h1 id="block-structure">Block Structure</h1>
<p>The <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/overview.html#GUID-826B070B-4888-4398-889B-61A3C6B91349">basic block structure</a>
is as follows. HEADER is PROCEDURE etc. and allows the block to be named, and hence called from other places. Without a header, you have an <em>anonymous</em> block.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">HEADER (PROC, <span style="color:#66d9ef">FUNCTION</span>, PACKAGE <span style="color:#66d9ef">or</span> PACKAGE BODY)
<span style="color:#66d9ef">IS</span>
    declaration section
<span style="color:#66d9ef">BEGIN</span>
    execution section
<span style="color:#66d9ef">EXCEPTION</span>
    <span style="color:#66d9ef">exception</span> section
<span style="color:#66d9ef">END</span>;
</code></pre></div><p>Anonymous blocks are for <em>immediate execution</em>. An anonymous block has a slightly different syntax:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    declaration section
<span style="color:#66d9ef">BEGIN</span>
    execution section
<span style="color:#66d9ef">EXCEPTION</span>
    <span style="color:#66d9ef">exception</span> section
<span style="color:#66d9ef">END</span>;
</code></pre></div><p>Blocks can be nested. Typically, one defines a <em>nested procedure or function</em> in the declaration section. It can refer to variables and types defined in the enclosing block (like a closure).</p>
<h1 id="loops">Loops</h1>
<p>All loops support <code>CONTIUNE</code> and <code>CONTINUE WHEN expr</code>.</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-0E130F2D-9635-4C0B-9D63-16C3D9FBE7D2">Simple loop</a>, aka. loop with exit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">LOOP
    EXIT <span style="color:#66d9ef">WHEN</span> some_condition;
    <span style="color:#75715e">-- or RETURN
</span><span style="color:#75715e"></span>    <span style="color:#75715e">-- or IF some_condition THEN EXIT; END IF;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p>Infinite loop with sleeping:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">LOOP
    <span style="color:#75715e">-- do work
</span><span style="color:#75715e"></span>    DBMS_LOCK.SLEEP(<span style="color:#ae81ff">10</span>);    <span style="color:#75715e">-- seconds
</span><span style="color:#75715e"></span><span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-C4BC9960-5945-4646-BBDE-DC00346F8702">Numeric FOR loop</a>. Inclusive of lower and upper bounds. BY is Oracle 21c.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> vIndex <span style="color:#66d9ef">IN</span> [REVERSE] lower_bound .. upper_bound [<span style="color:#66d9ef">BY</span> n] LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p>Cursor FOR loop using an inline SELECT statement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> rec <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> ...) LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-9AEEFDB6-8084-439C-948E-E1893C49FD94">Cursor FOR loop</a> using a declared cursor:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> rec <span style="color:#66d9ef">IN</span> curMyCursor LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p>This is much more concise than the equivalent explicit formulation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> curFoo <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    vFoo curFoo<span style="color:#f92672">%</span>ROWTYPE;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">OPEN</span> curFoo;
    LOOP
        <span style="color:#66d9ef">FETCH</span> curFoo <span style="color:#66d9ef">INTO</span> vFoo;
        EXIT <span style="color:#66d9ef">WHEN</span> curFoo<span style="color:#f92672">%</span>NOTFOUND;
    <span style="color:#66d9ef">END</span> LOOP;
    <span style="color:#66d9ef">CLOSE</span> curFoo;
<span style="color:#66d9ef">END</span>;
</code></pre></div><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-3F69F563-BCAE-4D3E-8E03-F53C8D64D093">WHILE loop</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">WHILE condition LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-3F424C1F-9C0F-4002-859C-DEAD94FECA82">Collection iteration loop</a>. From Oracle 21c:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> i <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">VALUES</span> <span style="color:#66d9ef">OF</span> vec LOOP ...
<span style="color:#66d9ef">FOR</span> i <span style="color:#66d9ef">IN</span> INDICES <span style="color:#66d9ef">OF</span> vec LOOP ...
<span style="color:#66d9ef">FOR</span> i,j <span style="color:#66d9ef">IN</span> PAIRS <span style="color:#66d9ef">OF</span> <span style="color:#66d9ef">result</span> LOOP ...
</code></pre></div><h1 id="exceptions">Exceptions</h1>
<p>There are a large number of pre-defined
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-error-handling.html#GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1">named exceptions</a>
which cover common error conditions including <code>NO_DATA_FOUND, TOO_MANY_ROWS, ZERO_DIVIDE, INVALID_NUMBER, VALUE_ERROR, DUP_VAL_ON_INDEX, INVALID_CURSOR, CURSOR_ALREADY_OPEN</code>. You can also create your own named exceptions and
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-error-handling.html#GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4">RAISE them</a>
just like the standard built-in exceptions. <strong>However, this exception is limited to the scope of the block</strong>. Also here we demonstrate the flexibility of the WHEN clause:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    exImproperWrangling <span style="color:#66d9ef">EXCEPTION</span>;
<span style="color:#66d9ef">BEGIN</span>
    ...
    RAISE exImproperWrangling;
    ...
<span style="color:#66d9ef">EXCEPTION</span>
    <span style="color:#66d9ef">WHEN</span> NO_DATA_FOUND <span style="color:#66d9ef">THEN</span> ...
    <span style="color:#66d9ef">WHEN</span> exImproperWrangling <span style="color:#66d9ef">THEN</span> ...
    <span style="color:#66d9ef">WHEN</span> exFirst <span style="color:#66d9ef">OR</span> exSecond <span style="color:#66d9ef">OR</span> exThird <span style="color:#66d9ef">THEN</span> ...
    <span style="color:#66d9ef">WHEN</span> OTHERS <span style="color:#66d9ef">THEN</span> ...
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="raising-custom-exceptions">Raising Custom Exceptions</h2>
<p>Create a package to hold your application-wide exceptions and associate the name with a number using the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/EXCEPTION_INIT-pragma.html">EXCEPTION_INIT pragma</a>. The number must be between -20,000 and -20,999.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> PACKAGE MyExceptions
<span style="color:#66d9ef">IS</span>
    INVALID_WRANGLING CONSTANT NUMBER :<span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">20000</span>;
    excINVALID_WRANGLING <span style="color:#66d9ef">EXCEPTION</span>;
    PRAGMA EXCEPTION_INIT (INVALID_WRANGLING, <span style="color:#f92672">-</span><span style="color:#ae81ff">20000</span>);
    ...
</code></pre></div><p>We can then raise them and refer to them as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">    ...
    RAISE_APPLICATION_ERROR(MyExceptions.INVALID_WRANGLING, <span style="color:#e6db74">&#39;Custom msg here&#39;</span>);
    ...
<span style="color:#66d9ef">EXCEPTION</span>
    <span style="color:#66d9ef">WHEN</span> excINVALID_WRANGLING <span style="color:#66d9ef">THEN</span> ...
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="error-built-ins">Error Built-ins</h2>
<ul>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/SQLCODE-function.html">SQLCODE</a> returns the number of the last error, or 0 if there was no error.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/SQLERRM-function.html">SQLERRM(n)</a> returns the error message for <code>n</code>, or if <code>n</code> is not specified then the current error as specified by <code>SQLCODE</code>. If there is no error, &lsquo;ORA-0000: normal, successful completion&rsquo; is returned.</li>
<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/arpls/DBMS_UTILITY.html#GUID-BF8C0CE6-872A-4CD8-9A78-5FB11C2206EC">DBMS_UTILITY.FORMAT_ERROR_STACK</a>, <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/arpls/DBMS_UTILITY.html#GUID-6AF22B6A-ED2E-4272-9159-9347C662060B">DBMS_UTILITY.FORMAT_ERROR_BACKTRACE</a>, and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/arpls/DBMS_UTILITY.html#GUID-89F43F70-F3AD-4DC6-A0EC-ED1E3CEE6648">DBMS_UTILITY.FORMAT_CALL_STACK</a> can all be used to get useful information about the exception environment.</li>
</ul>
<h1 id="useful-system-views">Useful System Views</h1>
<h1 id="using-rowids">Using RowIds</h1>
<h1 id="query-plans">Query Plans</h1>
<h1 id="uri-types-and-network-access-from-within-the-db">URI Types and Network Access from within the DB</h1>
<p>See page 452.</p>
<h1 id="rights-models">Rights Models</h1>
<p><em>definer rights model</em> - access to objects is determined at the time of compilation</p>
<p><em>invoker rights model</em> - uses <code>AUTHID CURRENT USER</code> to determine access to objects at runtime
See Chapter 24.</p>
<h1 id="oracle-sql">Oracle SQL</h1>
<h2 id="sequences">Sequences</h2>
<p>To define a sequence, use the
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/CREATE-SEQUENCE.html#GUID-E9C78A8C-615A-4757-B2A8-5E6EFB130571">CREATE SEQUENCE</a> statement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> SEQUENCE <span style="color:#66d9ef">schema_name</span>.sequence_name
[<span style="color:#66d9ef">INCREMENT</span> <span style="color:#66d9ef">BY</span> interval]
[<span style="color:#66d9ef">START</span> <span style="color:#66d9ef">WITH</span> first_number]
[<span style="color:#66d9ef">MAXVALUE</span> max_value <span style="color:#f92672">|</span> NOMAXVALUE]
[<span style="color:#66d9ef">MINVALUE</span> min_value <span style="color:#f92672">|</span> NOMINVALUE]
[<span style="color:#66d9ef">CYCLE</span> <span style="color:#f92672">|</span> NOCYCLE]
[<span style="color:#66d9ef">CACHE</span> cache_size <span style="color:#f92672">|</span> NOCACHE]
[<span style="color:#66d9ef">ORDER</span> <span style="color:#f92672">|</span> NOORDER];
</code></pre></div><p>To get the next value from a sequence, you can simply call the <code>NEXTVAL</code> function from a SQL statement such as an INSERT or a PL/SQL statement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> MyTable(Id, Name)
<span style="color:#66d9ef">VALUES</span> (MySequence.NEXTVAL, <span style="color:#e6db74">&#39;Phil&#39;</span>);

vNextVal :<span style="color:#f92672">=</span> MySequence.NEXTVAL;
</code></pre></div><p>Sequences can also be used in DEFAULT expressions for table columns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> MyTable
    (
        Id NUMBER(<span style="color:#ae81ff">16</span>) <span style="color:#66d9ef">DEFAULT</span> MySchema.MySequence.NEXTVAL <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
        Name NVARCHAR2(<span style="color:#ae81ff">50</span>)
    )
</code></pre></div><h2 id="cursor-attributes">Cursor Attributes</h2>
<p>When executing a SQL statement in PL/SQL, there are some
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/implicit-cursor-attribute.html#GUID-5A938EE7-E8D2-468C-B60F-81898F110BE1">Implicit Cursor Attributes</a>
that you can use in your logic:</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">SQL%FOUND</td>
<td>Returns TRUE if one or more rows were modified</td>
</tr>
<tr>
<td align="center">SQL%NOTFOUND</td>
<td>Returns TRUE if no rows were modified</td>
</tr>
<tr>
<td align="center">SQL%ROWCOUNT</td>
<td>Returns the number of modified rows</td>
</tr>
</tbody>
</table>
<h1 id="dml-optimisation-with-forall">DML Optimisation with FORALL</h1>
<p>The <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/FORALL-statement.html#GUID-C45B8241-F9DF-4C93-8577-C840A25963DB">FORALL</a>
statement batches DML statements and sends them all to the
execution engine together. This reduces the number of round trips
and can massively increase performance. The body of the FORALL
must be a single DML statement that refers to collections via an index.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> IdTable <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> People.PeopleId<span style="color:#f92672">%</span><span style="color:#66d9ef">TYPE</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">BY</span> PLS_INTEGER;

    <span style="color:#66d9ef">TYPE</span> OccupationsTable <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> VARCHAR(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">BY</span> PLS_INTEGER;

<span style="color:#66d9ef">BEGIN</span>
    FORALL idx <span style="color:#66d9ef">IN</span> vPeople.<span style="color:#66d9ef">FIRST</span> .. vPeople.<span style="color:#66d9ef">LAST</span>
        <span style="color:#66d9ef">UPDATE</span> People <span style="color:#66d9ef">SET</span>
            Occupation <span style="color:#f92672">=</span> vOccupations(idx)
        <span style="color:#66d9ef">WHERE</span>
            PeopleId <span style="color:#f92672">=</span> vIds(idx)
        RETURNING Occupation
        BULK COLLECT <span style="color:#66d9ef">INTO</span> vOccs;
<span style="color:#66d9ef">END</span>;
</code></pre></div><p>Note that the above shows how we can also use a <code>RETURNING</code> clause: because <code>FORALL</code> is a bulk operation we must
use <code>BULK COLLECT</code> rather than just <code>COLLECT</code>.</p>
<h2 id="cursor-attributes-set-by-forall">Cursor attributes set by FORALL</h2>
<p><code>FORALL</code> helpfully sets various cursor attributes so that you can check the
results of the DML operation.</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">SQL%FOUND</td>
<td>Returns TRUE if one or more rows were modified</td>
</tr>
<tr>
<td align="center">SQL%NOTFOUND</td>
<td>Returns TRUE if no rows were modified</td>
</tr>
<tr>
<td align="center">SQL%ROWCOUNT</td>
<td>Returns the number of modified rows</td>
</tr>
<tr>
<td align="center">SQL%BULK_ROWCOUNT</td>
<td>A collection that tells you how many rows were changed by each DML statement</td>
</tr>
<tr>
<td align="center">SQL%BULK_EXCEPTIONS</td>
<td>A collection that tells you of any exceptions raised</td>
</tr>
</tbody>
</table>
<p>Typically, when you are updating a row identified by a PK, <code>SQL%BULK_ROWCOUNT(idx)</code> will be 0 or 1.</p>
<h2 id="dealing-with-exceptions-in-forall-statements">Dealing with Exceptions in FORALL statements</h2>
<p>By default, if any DML statement in a <code>FORALL</code> generates an exception then the whole statement (every DML statement) will be rolled back. However, if you use the <code>SAVE EXCEPTIONS</code> clause, the Oracle engine will give you a chance to
deal with the errors.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">BEGIN</span>
    FORALL idx <span style="color:#66d9ef">IN</span> <span style="color:#ae81ff">1</span>..<span style="color:#ae81ff">20</span>
        SAVE EXCEPTIONS
        <span style="color:#66d9ef">UPDATE</span> ...
<span style="color:#66d9ef">EXCEPTION</span>
    <span style="color:#66d9ef">WHEN</span> OTHERS <span style="color:#66d9ef">THEN</span>
        <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">SQLCODE</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">24831</span> <span style="color:#66d9ef">THEN</span>
            <span style="color:#66d9ef">FOR</span> indx <span style="color:#66d9ef">IN</span> <span style="color:#ae81ff">1</span> .. <span style="color:#66d9ef">SQL</span><span style="color:#f92672">%</span>BULK_EXCEPTIONS.<span style="color:#66d9ef">COUNT</span> LOOP
                <span style="color:#75715e">-- Find the index of the element that caused an exception
</span><span style="color:#75715e"></span>                i :<span style="color:#f92672">=</span> <span style="color:#66d9ef">SQL</span><span style="color:#f92672">%</span>BULK_EXCEPTIONS(indx).ERROR_INDEX;
                <span style="color:#75715e">-- ERROR_CODE returns the SQL error code. Multiple by -1
</span><span style="color:#75715e"></span>                <span style="color:#75715e">-- before using with SQLERRM.
</span><span style="color:#75715e"></span>
                <span style="color:#75715e">-- Take corrective action here...
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">END</span> LOOP;
        <span style="color:#66d9ef">ELSE</span>
            RAISE;
        <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;

</code></pre></div><h1 id="returning-clauses">Returning Clauses</h1>
<p>A <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/RETURNING-INTO-clause.html#GUID-38F735B9-1100-45AF-AE71-18FB74A899BE">RETURNING</a>
allows you to get information about the rows affected by
an UPDATE, DELETE OR INSERT statement (rarely used with INSERT, but can be used to get a default value). The syntax for single rows and multiple rows differs slightly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    vSalary Employees.Salary<span style="color:#f92672">%</span><span style="color:#66d9ef">TYPE</span>;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">UPDATE</span> Employees <span style="color:#66d9ef">SET</span>
        Salary <span style="color:#f92672">=</span> Salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
    RETURNING salary <span style="color:#66d9ef">INTO</span> vSalary;
<span style="color:#66d9ef">END</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
   <span style="color:#66d9ef">names</span> name_varray;
   new_salaries number_varray;
<span style="color:#66d9ef">BEGIN</span>
    populate_arrays(<span style="color:#66d9ef">names</span>, new_salaries);

    FORALL indx <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">names</span>.<span style="color:#66d9ef">FIRST</span>..<span style="color:#66d9ef">names</span>.<span style="color:#66d9ef">LAST</span>
        <span style="color:#66d9ef">UPDATE</span> compensation <span style="color:#66d9ef">SET</span>
            salary <span style="color:#f92672">=</span> new_salaries(indx)
        <span style="color:#66d9ef">WHERE</span>
            last_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">names</span>(indx)
        RETURNING salary BULK COLLECT <span style="color:#66d9ef">INTO</span> new_salaries;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="transactions">Transactions</h2>
<p>There is no <code>BEGIN TRAN</code>. Oracle starts a transaction implicitly with the first SQL statement issued after the last <code>COMMIT</code> or <code>ROLLBACK. If a </code>ROLLBACK TO SAVEPOINT` is issued then the transaction continues.</p>
<p>After <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/COMMIT.html#GUID-6CD5C9A7-54B9-4FA2-BA3C-D6B4492B9EE2">COMMIT</a> your changes will be visible to other database users.
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/ROLLBACK.html#GUID-94551F0C-A47F-43DE-BC68-9B1C1ED38C93">ROLLBACK</a>
can rollback the entire transaction or to a
<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/SAVEPOINT.html#GUID-78EEA746-0021-42E8-9971-3BA6DFFEE794">SAVEPOINT</a>.</p>
<p>Savepoints allow you to establish &lsquo;partially done&rsquo; semantics within a transaction. Savepoint names must be unique within a transaction; if a name is reused then the savepoint is moved to the new location.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">SAVEPOINT my_savepoint;
...
<span style="color:#66d9ef">ROLLBACK</span>;
<span style="color:#66d9ef">ROLLBACK</span> <span style="color:#66d9ef">WORK</span>;
<span style="color:#66d9ef">ROLLBACK</span> <span style="color:#66d9ef">TO</span> my_savepoint;
</code></pre></div><p>You can use savepoints within loops to &lsquo;commit the good&rsquo; and &lsquo;reject the bad&rsquo;. <a href="https://tedstruik-oracle.nl/ords/f?p=25384:1092::::::">The general pattern is</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> ... LOOP
    <span style="color:#66d9ef">BEGIN</span>
        SAVEPOINT MySavepoint;
        <span style="color:#75715e">-- Do work here
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">EXCEPTION</span>
        <span style="color:#66d9ef">WHEN</span> OTHERS <span style="color:#66d9ef">THEN</span>
            <span style="color:#66d9ef">ROLLBACK</span> <span style="color:#66d9ef">TO</span> MySavepoint;
    <span style="color:#66d9ef">END</span>;
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/AUTONOMOUS_TRANSACTION-pragma.html#GUID-AD33D949-081B-4CD3-A240-C29773E908C3">Autonomous transactions</a> are transactions that are executed as their own unit, separate from any calling transaction. They are useful mainly for logging.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">PROCEDURE</span> Log(...)
<span style="color:#66d9ef">IS</span>
    PRAGMA AUTONOMOUS_TRANSACTION;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#75715e">-- Code...
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">-- An explicity commit or rollback is required. The calling
</span><span style="color:#75715e"></span>    <span style="color:#75715e">-- transaction then resumes.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">COMMIT</span>;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h1 id="cursors-for-data-retrieval">Cursors (for Data Retrieval)</h1>
<h2 id="definitions">Definitions</h2>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/static-sql.html#GUID-596C1961-5A94-40ED-9920-668BB05632C5">Implicit cursors</a></td>
<td>A simple SELECT .. INTO creates and uses a cursor. Used for one row</td>
</tr>
<tr>
<td align="left"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/static-sql.html#GUID-89E0242F-42AC-4B21-9DF1-ACD6F4FC03B9">Explicit cursors</a></td>
<td>A cursor declared in a local block or package. Used for 1 or more rows</td>
</tr>
<tr>
<td align="left">Cursor variables</td>
<td>A REF CURSOR, which is a pointer to a cursor&rsquo;s resultset</td>
</tr>
<tr>
<td align="left">Cursor expressions</td>
<td>The CURSOR expression transforms a SELECT into a REF CURSOR</td>
</tr>
<tr>
<td align="left">SELECT FOR UPDATE</td>
<td>A special type of SELECT which issues row locks on each row retrieved</td>
</tr>
</tbody>
</table>
<h2 id="cursor-attributes-1">Cursor Attributes</h2>
<p>There are 6 <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/static-sql.html#GUID-D483DF0B-15DB-4466-9870-0F6E1518A40D">Cursor Attributes</a>:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">%FOUND</td>
<td>Returns true if a row was fetched</td>
</tr>
<tr>
<td align="left">%NOTFOUND</td>
<td>Returns true if a row was NOT fetched</td>
</tr>
<tr>
<td align="left">%ROWCOUNT</td>
<td>Returns the number of rows fetched so far</td>
</tr>
<tr>
<td align="left">%ISOPEN</td>
<td>Returns true if the cursor is open</td>
</tr>
<tr>
<td align="left">%BULK_ROWCOUNT</td>
<td>Returns the number of rows modified by a FORALL</td>
</tr>
<tr>
<td align="left">%BULK_EXCEPTIONS</td>
<td>Returns exceptions for rows modified by a FORALL</td>
</tr>
</tbody>
</table>
<p>These are used in the following way for explicit cursors. For implicit cursors, the cursor name is always <code>&quot;SQL&quot;</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">vCursorName<span style="color:#f92672">%</span>ATTRIBUTE
</code></pre></div><h2 id="cursor-declarations">Cursor Declarations</h2>
<p>A basic declaration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...;
</code></pre></div><p>A cursor that names its return type - not neccessary but aids documentation. The <code>RETURN</code> clause can also refer to other cursors or record types:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">RETURN</span> myTable<span style="color:#f92672">%</span>ROWTYPE
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...;
</code></pre></div><p>Cursors can have parameters, including defaults:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> myBiggerCursor(
            p1 NUMBER(<span style="color:#ae81ff">10</span>),
            p2 VARCHAR2(<span style="color:#ae81ff">50</span>),
            p3 NUMBER <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">10000</span>
            ) <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...;
</code></pre></div><p>Cursors can also be declared in packages and their specs and bodies can be separated, which can reduce recompilations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL">PACKAGE x <span style="color:#66d9ef">IS</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">RETURN</span> MyRecType;
<span style="color:#66d9ef">END</span>;
PACKAGE BODY x <span style="color:#66d9ef">IS</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">RETURN</span> MyRecType
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span>...
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="cursor-usage">Cursor Usage</h2>
<p>As noted in  <a href="#loops">Loops</a> above, once a cursor is declared you can loop over the records using a <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-control-statements.html#GUID-9AEEFDB6-8084-439C-948E-E1893C49FD94">Cursor FOR loop</a> or explicitly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FOR</span> rec <span style="color:#66d9ef">IN</span> curMyCursor LOOP
    ...
<span style="color:#66d9ef">END</span> LOOP;
</code></pre></div><p>This is much more concise than the equivalent explicit formulation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> curFoo <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    vFoo curFoo<span style="color:#f92672">%</span>ROWTYPE;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">OPEN</span> curFoo;
    LOOP
        <span style="color:#66d9ef">FETCH</span> curFoo <span style="color:#66d9ef">INTO</span> vFoo;
        EXIT <span style="color:#66d9ef">WHEN</span> curFoo<span style="color:#f92672">%</span>NOTFOUND;
    <span style="color:#66d9ef">END</span> LOOP;
    <span style="color:#66d9ef">CLOSE</span> curFoo;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h2 id="cursors---locking-rows-with-for-update">Cursors - Locking Rows with FOR UPDATE</h2>
<p>Normally a cursor does not lock rows that it reads. Others will be able to update those rows (though you will not see their changes).</p>
<p>The <code>FOR UPDATE</code> clause allows you to lock a set of records before you update them. Row-level locks are applied <strong>as soon as the cursor is opened</strong>, preventing others from updating those rows. Other sessions can still read those rows, but will not be able to see your changes until you COMMIT (note that the first COMMIT will release ALL locks from the cursor, so you won&rsquo;t be able to fetch more rows after the COMMIT).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span>;

    <span style="color:#75715e">-- or..
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">OF</span> col1, col2;

    <span style="color:#75715e">-- or..for cursors that refer to multiple tables we can
</span><span style="color:#75715e"></span>    <span style="color:#75715e">-- make it so we only lock rows in one of the tables.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ... <span style="color:#66d9ef">FROM</span> tbl1, tbl2
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">OF</span> tbl2.col2;
</code></pre></div><p>What if the rows are locked by another session? By default, <code>FOR UPDATE</code> will wait until the rows are available or a timeout occurs</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span>;     <span style="color:#75715e">-- Wait forever (really until timeout)
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> WAIT <span style="color:#ae81ff">10</span>;     <span style="color:#75715e">-- Wait 10 seconds
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> NOWAIT;      <span style="color:#75715e">-- Don&#39;t wait
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">CURSOR</span> myCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">SELECT</span> ...
    <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> SKIP LOCKED;      <span style="color:#75715e">-- Skip locked rows
</span></code></pre></div><p>The exception that occurs on timeout is a named system exception called <code>TIMEOUT_ON_RESOURCE</code>.</p>
<h2 id="cursors---avoiding-using-rowids-and-primary-key-clauses">Cursors - Avoiding using ROWIDs and Primary Key clauses</h2>
<p>You can use <a href="">WHERE CURRENT OF</a>
to update or delete the last fetched row in a table. This means you don&rsquo;t need to write complicated Primary Key equality WHERE clauses or retrieve ROWIDs.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">table_name</span>
<span style="color:#66d9ef">SET</span> set_clause
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">CURRENT</span> <span style="color:#66d9ef">OF</span> myCursor;

<span style="color:#66d9ef">DELETE</span>
<span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">table_name</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">CURRENT</span> <span style="color:#66d9ef">OF</span> myCursor;
</code></pre></div><h2 id="cursors---cursor-variables-and-reference-cursors">Cursors - Cursor Variables and Reference Cursors</h2>
<p>The explicit and implicit cursors defined above are both types of <strong>static</strong> cursor - they define fixed names which can be referred to in code. The schema of records returned by the cursor is fixed at compile time.</p>
<p>Oracle also has <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/static-sql.html#GUID-4A6E054A-4002-418D-A1CA-DE849CD7E6D5">cursor variables</a>,
which <strong>point to</strong> the underlying cursor. Cursor variables can be passed to functions, copied, associated with different queries at different times, and assigned to each other (so that you end up with two pointers to the same underlying cursor execution area).</p>
<p>Declare a cursor variable like this - the syntax gives rise to the alternative name &lsquo;REF CURSOR&rsquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> myCurType <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">REF</span> <span style="color:#66d9ef">CURSOR</span> [<span style="color:#66d9ef">RETURN</span> return_type];
    vMyCur myCurType;

    vMyWeakCursor SYS_REFCURSOR;
</code></pre></div><p>If the <code>RETURN</code> clause is specified, then the cursor type is <strong>strong</strong>, else it is <strong>weak</strong>. Strong cursor variables must always be used with SELECTs that return appropriate column schemas, on the other hand weak cursor variables are polymorphic - they can be used (carefully) with any SELECT statement.</p>
<p>The built-in type <code>SYS_REFCURSOR</code> can be used to declare weak cursor variables, therefore there is little need to declare your own weak cursor types.</p>
<p>Unfortunately, you can&rsquo;t use a <code>FOR LOOP</code> with SYS_REFCURSOR. You must <code>FETCH</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
  vCur1 SYS_REFCURSOR;
  vRec MyTable<span style="color:#f92672">%</span>ROWTYPE;
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">OPEN</span> vCur1 <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> MyTable;
  
  LOOP
    <span style="color:#66d9ef">FETCH</span> vCur1 <span style="color:#66d9ef">INTO</span> vRec;
    EXIT <span style="color:#66d9ef">WHEN</span> vCur1<span style="color:#f92672">%</span>NOTFOUND;
    DBMS_OUTPUT.PUT_LINE(vRec.CreatedDate);
  <span style="color:#66d9ef">END</span> LOOP;
  <span style="color:#66d9ef">CLOSE</span> vCur1;
<span style="color:#66d9ef">END</span>;
</code></pre></div><p>Returning data to client programs is typically done using a <code>SYS_REFCURSOR</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FUNCTION</span> foo <span style="color:#66d9ef">RETURN</span> SYS_REFCURSOR 
<span style="color:#66d9ef">IS</span>
    vReturn SYS_REFCURSOR;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">OPEN</span> vReturn <span style="color:#66d9ef">FOR</span>
    <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> ...;
    <span style="color:#66d9ef">RETURN</span> vReturn;
<span style="color:#66d9ef">END</span> foo;
</code></pre></div><h2 id="cursor-expressions">Cursor Expressions</h2>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/static-sql.html#GUID-77FF2850-F338-4C77-9577-0FE3399D39BA">Cursor expressions</a> can be used to create &lsquo;nested SELECTs&rsquo;, such as retrieving a subquery as a column in an outer query. They are niche, see the linked documentation for an example.</p>
<p>However, one important use is for creating <a href="#streaming-functions">Streaming Functions</a>. They can also be used to pass resultsets into functions</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> young_managers
<span style="color:#66d9ef">AS</span>
    <span style="color:#66d9ef">SELECT</span> managers.employee_id <span style="color:#66d9ef">AS</span> manager_employee_id
    <span style="color:#66d9ef">FROM</span> employees managers
    <span style="color:#66d9ef">WHERE</span>
        <span style="color:#75715e">-- This is the function. It takes two params:
</span><span style="color:#75715e"></span>        <span style="color:#75715e">-- a cursor and a date.
</span><span style="color:#75715e"></span>        most_reports_before_manager
        (
        <span style="color:#66d9ef">CURSOR</span>
            (
            <span style="color:#66d9ef">SELECT</span> reports.hire_date
            <span style="color:#66d9ef">FROM</span> employees reports
            <span style="color:#66d9ef">WHERE</span> reports.manager_id <span style="color:#f92672">=</span> managers.employee_id
            ),
        managers.hire_date
      ) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</code></pre></div><h1 id="functions-and-procedures">Functions and Procedures</h1>
<h2 id="table-functions">Table functions</h2>
<p>Table functions return a resultset and can be referenced in a <code>FROM</code> clause. Such functions must return a
<a href="#nested-tables">nested table</a>
or
<a href="#varrays">VARRAY</a> - in practive a nested table tends to be favoured because VARRAYs require a maximum size to be specified.</p>
<p>Given a definition</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> MyObject <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">OBJECT</span> (...);
    <span style="color:#66d9ef">TYPE</span> MyObjectTable <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> MyObject;

    <span style="color:#66d9ef">FUNCTION</span> DoStuff(i PLS_INTEGER)
    <span style="color:#66d9ef">RETURN</span> MyObjectTable
    <span style="color:#66d9ef">IS</span>
    <span style="color:#66d9ef">BEGIN</span>
        ...
    <span style="color:#66d9ef">END</span> DoStuff;
</code></pre></div><p>We can then use this function in <code>SELECT</code> statements as follows</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span>
    <span style="color:#66d9ef">TABLE</span>(DoStuff(<span style="color:#ae81ff">42</span>));
</code></pre></div><p>This simple example uses just a scalar parameter to the function, but if the function takes a cursor then the call will look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span>
    <span style="color:#66d9ef">TABLE</span>(
        DoStuffWithResultset(
                <span style="color:#66d9ef">CURSOR</span>(<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> SomeTable)
            )
    );
</code></pre></div><p>i.e. we use <code>CURSOR</code> to make a weak ref cursor from the SELECT and then pass that into our function (where we LOOP over it) and then pass the results into the <code>TABLE</code> pseudo-function.</p>
<h2 id="pipelined-functions">Pipelined functions</h2>
<p>Pipelined functions yield rows asynchronously to their caller, like a Unix pipe. Syntactically, the changes compared to the function above are simple, involving adding the word PIPELINED to the <code>RETURN</code> specification and using the <code>PIPE ROW</code> statement in the body:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">DECLARE</span>
    <span style="color:#66d9ef">TYPE</span> MyObject <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">OBJECT</span> (...);
    <span style="color:#66d9ef">TYPE</span> MyObjectTable <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">OF</span> MyObject;

    <span style="color:#66d9ef">FUNCTION</span> DoStuff(i PLS_INTEGER)
    <span style="color:#66d9ef">RETURN</span> MyObjectTable PIPELINED
    <span style="color:#66d9ef">IS</span>
    <span style="color:#66d9ef">BEGIN</span>
        LOOP
            <span style="color:#75715e">-- Make an object...
</span><span style="color:#75715e"></span>            PIPE <span style="color:#66d9ef">ROW</span> (vNextObject)
        <span style="color:#66d9ef">END</span> LOOP;

        <span style="color:#75715e">-- We already sent all rows,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">-- so there is nothing to return at the end.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">RETURN</span>;
    <span style="color:#66d9ef">END</span> DoStuff;
</code></pre></div><p>Calling this pipelined function is identical to calling the non-pipelined version.</p>
<p>If you want to create a function that transforms a recordset, you need to write it to take a REF CURSOR as a parameter.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">TYPE</span> MyRefCur <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">REF</span> <span style="color:#66d9ef">CURSOR</span> <span style="color:#66d9ef">RETURN</span> MyTable<span style="color:#f92672">%</span>ROWTYPE;

<span style="color:#66d9ef">FUNCTION</span> DoStuff2(vData MyRefCur)
<span style="color:#66d9ef">RETURN</span> MyObjectTable PIPELINED
<span style="color:#66d9ef">IS</span>
    vCursorRow MyTable<span style="color:#f92672">%</span>ROWTYPE;
<span style="color:#66d9ef">BEGIN</span>
    ...
    LOOP
        <span style="color:#66d9ef">FETCH</span> vData <span style="color:#66d9ef">INTO</span> vCursorRow;
        EXIT <span style="color:#66d9ef">WHEN</span> vData<span style="color:#f92672">%</span>NOTFOUND;

        <span style="color:#75715e">-- Tramp data across.
</span><span style="color:#75715e"></span>        vMyObject.Id :<span style="color:#f92672">=</span> vCursorRow.Id;
        ...
        PIPE <span style="color:#66d9ef">ROW</span>(vMyObject);
    <span style="color:#66d9ef">END</span> LOOP;

    <span style="color:#66d9ef">CLOSE</span> vData;
    ...
<span style="color:#66d9ef">END</span> DoStuff2;
</code></pre></div><p>Pipelined functions can be <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lnpls/plsql-optimization-and-tuning.html#GUID-ED557894-EC08-47E0-A629-0E4AEDDBB77B">chained</a> to create complex transformations.</p>
<p>Pipelined functions are good for performance because they use less memory, and they can be the
source of data for a set-based end-of-pipeline operations, such as an INSERT. However, they will typically not be as fast as a set-based SQL solution using <code>FORALL</code> and <code>BULK COLLECT</code>. The gap can be diminished by
changing the start of the pipeline to use a <code>BULK COLLECT..LIMIT</code>, instead of reading from a cursor one row at a time.</p>
<h2 id="parallel-functions">Parallel Functions</h2>
<p>To execute a function in parallel it must have 1 parameter which is a strongly-typed REF CURSOR.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FUNCTION</span> Stage(vData MyRefCurType)
<span style="color:#66d9ef">RETURN</span> MyObjectTable
PIPELINED
PARALLEL_ENABLE (PARTITION vData <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">ANY</span>)
</code></pre></div><p><code>BY ANY</code> is fastest and is used in cases <strong>where there is no relationship between the rows</strong>. You can also use <code>CLUSTER BY</code> and <code>ORDER BY</code>.</p>
<p>However, this is not sufficient to get a whole pipeline to run in parallel - you will also need to run the start of the pipeline in parallel. Example
from Feuerstein, chapter 21, where <code>pipe_stocks_parallel</code> is his parallel function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">PROCEDURE</span> DoStuff <span style="color:#66d9ef">IS</span>
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">EXECUTE</span> <span style="color:#66d9ef">IMMEDIATE</span> <span style="color:#e6db74">&#39;ALTER SESSION ENABLE PARALLEL DML&#39;</span>;

    <span style="color:#66d9ef">INSERT</span> <span style="color:#75715e">/*+ PARALLEL(t, 4) */</span>
    <span style="color:#66d9ef">INTO</span> tickertable t(ticker, price_type, price, price_date)
    <span style="color:#66d9ef">SELECT</span> ticker, price_type, price, price_date
    <span style="color:#66d9ef">FROM</span>
        <span style="color:#66d9ef">TABLE</span>(
             stockpivot_pkg.pipe_stocks_parallel(
                <span style="color:#66d9ef">CURSOR</span>(<span style="color:#66d9ef">SELECT</span> <span style="color:#75715e">/*+ PARALLEL(s, 4) */</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> stocktable s)));
<span style="color:#66d9ef">END</span> DoStuff;
</code></pre></div><p>The same technique works for parallel <code>MERGE</code> statements.</p>
<h2 id="advanced-functions">Advanced Functions</h2>
<p>For more advanced examples, including returning multiple types of data from a pipelined function, and <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/INSERT.html#GUID-903F8043-0254-4EE9-ACC1-CB8AC0AF3423">Multi-table INSERTs</a>,
see Feuerstein, Chapter 21.</p>
<h2 id="deterministic-functions">Deterministic Functions</h2>
<p>If the output of a function is completely and solely determined by its input parameters (hence it cannot refer to any tables or non-deterministic functions such as <code>SYSDATE</code>) then it can be marked as <code>DETERMINISTIC</code> which enables Oracle to cache the results (though it only does so when the function is called from within a SQL statement):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">FUNCTION</span> UP(A VARCHAR2) <span style="color:#66d9ef">RETURN</span> VARCHAR2 <span style="color:#66d9ef">DETERMINISTIC</span>
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">RETURN</span> <span style="color:#66d9ef">UPPER</span>(A);
<span style="color:#66d9ef">END</span> UP;
</code></pre></div><h2 id="displaying-cursors-tsql-style">DIsplaying Cursors (TSQL style)</h2>
<p>To print a resultset from a proc (like TSQL does), you can use the built-in function <code>DBMS_SQL.RETURN_RESULT</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">PROCEDURE</span> ShowStuff()
<span style="color:#66d9ef">IS</span>
    vCur SYS_REFCURSOR;
<span style="color:#66d9ef">BEGIN</span>
    <span style="color:#66d9ef">OPEN</span> vCur <span style="color:#66d9ef">FOR</span>
    <span style="color:#66d9ef">SELECT</span> ...

    <span style="color:#75715e">-- Magic here.
</span><span style="color:#75715e"></span>    DBMS_SQL.RETURN_RESULT(vCur);
<span style="color:#66d9ef">END</span> ShowStuff;
</code></pre></div><h1 id="packages">Packages</h1>
<h2 id="hiding-of-implementation-details">Hiding of implementation details</h2>
<p>Procedures, functions and cursors can be declared in a package spec but their implementation can be hidden in the body. For other elements, if they are in the spec they must be fully declared, and they become public.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">PROCEDURE</span> XYZ(A PLS_INTEGER) <span style="color:#66d9ef">RETURN</span> VARCHAR2;

<span style="color:#66d9ef">TYPE</span> MyCursor <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">REF</span> <span style="color:#66d9ef">CURSOR</span> <span style="color:#66d9ef">RETURN</span> MyTable<span style="color:#f92672">%</span>ROWTYPE;
</code></pre></div><h2 id="initialization">Initialization</h2>
<p>A package body can specify code to be executed when the package is first instantiated. It goes within a <code>BEGIN..END</code> block in the package body. It can be used to perform complex initialisation or to cache information. Its use should generally be avoided as packages can be invalidated at any time and the logic might be confusing.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/blog/2022/oracle-udt-class-generator/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">A C# Source Generator for Oracle UDTs</span>
    </a>
    
    
    <a href="/blog/2023/2023-pics/" class="navigation-next">
      <span class="navigation-tittle">2023 Pics for Sharing</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'philipdanielscomblog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    
  
  
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QK1BLJ71TN');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QK1BLJ71TN"></script>

<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/rust.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/cs.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/bash.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/python.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/css.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/http.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/ini.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/javascript.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/json.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/markdown.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/sql.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/html.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/xml.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/dockerfile.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/scss.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/r.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/typescript.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/go.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/cpp.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/dos.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/plaintext.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/powershell.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/diff.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/makefile.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/lisp.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["rust, cs, bash, python, css, http, ini, javascript, json, markdown, sql, html, xml, dockerfile, scss, r, typescript, go, cpp, dos, plaintext, powershell, diff, makefile, lisp"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
