<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.53" />

    
    
    

<title>Summary of Stephen Cleary&#39;s &#39;Tour of Task&#39; Series â€¢ Phil&#39;s Blog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Summary of Stephen Cleary&#39;s &#39;Tour of Task&#39; Series"/>
<meta name="twitter:description" content="Summary of Stephen Cleary&rsquo;s &lsquo;A Tour of Task&rsquo; articles The first article
 Task as used by TPL is completely different to Task as used by async. The vast majority of Task members have no place in async code. There are two types of Task ** Delegate tasks, which have code to run ** Promise tasks, which represent an event or signal (e.g. IO or timer based) Most TPL code uses Delegate tasks across multiple threads,, most async code uses Promise tasks which don&rsquo;t tie up a thread."/>

<meta property="og:title" content="Summary of Stephen Cleary&#39;s &#39;Tour of Task&#39; Series" />
<meta property="og:description" content="Summary of Stephen Cleary&rsquo;s &lsquo;A Tour of Task&rsquo; articles The first article
 Task as used by TPL is completely different to Task as used by async. The vast majority of Task members have no place in async code. There are two types of Task ** Delegate tasks, which have code to run ** Promise tasks, which represent an event or signal (e.g. IO or timer based) Most TPL code uses Delegate tasks across multiple threads,, most async code uses Promise tasks which don&rsquo;t tie up a thread." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.philipdaniels.com/blog/2017/tour-of-task/" /><meta property="article:published_time" content="2017-11-06T20:19:45&#43;00:00"/>
<meta property="article:modified_time" content="2017-11-06T20:19:45&#43;00:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/gruvbox-dark.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

    
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-51573023-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.philipdaniels.com/">Phil&#39;s Blog</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/5f3e5fe7d6a4062ad188336e06f1cb78?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Phil&#39;s Blog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/gitcheatsheet">
						<span>My Git CheatSheet</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/PhilipDaniels" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://stackoverflow.com/users/1313057/philip-daniels" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="mailto:philip.daniels1971@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 Philip Daniels
  
</div>



  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Summary of Stephen Cleary&#39;s &#39;Tour of Task&#39; Series</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Nov 6, 2017
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/c">c#</a>
           
      
          <a class="badge badge-tag" href="/tags/task">task</a>
           
      
          <a class="badge badge-tag" href="/tags/async">async</a>
           
      
          <a class="badge badge-tag" href="/tags/tpl">tpl</a>
           
      
          <a class="badge badge-tag" href="/tags/parallelism">parallelism</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    

<h1 id="summary-of-stephen-cleary-s-a-tour-of-task-articles">Summary of Stephen Cleary&rsquo;s &lsquo;A Tour of Task&rsquo; articles</h1>

<p><a href="http://blog.stephencleary.com/2014/04/a-tour-of-task-part-0-overview.html">The first article</a></p>

<ul>
<li>Task as used by <a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/task-parallel-library-tpl">TPL</a>
is completely different to Task as used by <code>async</code>.</li>
<li>The vast majority of Task members have no place in async code.</li>
<li>There are two types of Task
** Delegate tasks, which have code to run
** Promise tasks, which represent an event or signal (e.g. IO or timer based)</li>
<li>Most TPL code uses Delegate tasks across multiple threads,, most async code uses Promise tasks
which don&rsquo;t tie up a thread.</li>
</ul>

<h2 id="task-constructors">Task Constructors</h2>

<p><a href="http://blog.stephencleary.com/2014/05/a-tour-of-task-part-1-constructors.html">Original Article</a></p>

<ul>
<li>These can only create Delegate tasks. Promise tasks are created using the <code>async</code> keyword.</li>
<li>They create tasks that are not running. Don&rsquo;t use them.</li>
<li>Use <a href="https://msdn.microsoft.com/en-us/library/system.threading.tasks.parallel">Parallel</a>
or <a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/parallel-linq-plinq">PLINQ</a>
for parallel code.</li>
<li>For dynamic task parallelism, you can use <code>Task.Run</code> or <code>Task.Factory.StartNew</code>.</li>
</ul>

<h2 id="task-status">Task Status</h2>

<p><a href="http://blog.stephencleary.com/2014/06/a-tour-of-task-part-3-status.html">Original Article</a></p>

<ul>
<li>Rarely used except for debugging, normally wait for the task to complete and extract the
results.</li>
</ul>

<h2 id="waiting">Waiting</h2>

<p><a href="http://blog.stephencleary.com/2014/10/a-tour-of-task-part-5-wait.html">Original Article</a></p>

<ul>
<li>All <code>Wait</code> operations block the calling thread until the task completes, so they are never
used with Promise tasks. (Blocking on a Promise is a cause of deadlocks).</li>
<li><code>Wait</code> is rather simple: it will block the calling thread until the task completes, a timeout
occurs, or the wait is cancelled. If the wait is cancelled, then <code>Wait</code> raises an
<code>OperationCanceledException</code>. If a timeout occurs, then <code>Wait</code> returns false. If the task completes
in a failed or canceled state, then <code>Wait</code> wraps any exceptions into an <code>AggregateException</code>. Note
that a canceled task will raise an <code>OperationCanceledException</code> wrapped in an <code>AggregateException</code>,
whereas a canceled wait will raise an unwrapped <code>OperationCanceledException</code>.</li>
<li><code>WaitAll</code> and <code>WaitAny</code> are similar, but for collections of <code>Task</code>.</li>
<li>Use <code>await</code> instead of <code>Wait</code>.</li>
</ul>

<h2 id="results">Results</h2>

<p><a href="http://blog.stephencleary.com/2014/12/a-tour-of-task-part-6-results.html">Original Article</a></p>

<ul>
<li>Only exists on <code>Task&lt;T&gt;</code> type.</li>
<li>Blocks like <code>Wait</code>, with the same drawbacks.</li>
<li>Wraps any exceptions inside an <code>AggregateException</code>, which makes error handling complicated.</li>
<li><code>GetAwaiter().GetResult</code> blocks like <code>Result</code>, but does not wrap any exceptions. This works
for both <code>Task&lt;T&gt;</code> and <code>Task</code>. So if you have to block, this is better.</li>
<li>The vast majority of time, <code>await</code> should be used to get the result of a Promise task.</li>
</ul>

<h2 id="continuations">Continuations</h2>

<p><a href="http://blog.stephencleary.com/2015/01/a-tour-of-task-part-7-continuations.html">Original Article</a></p>

<ul>
<li>Don&rsquo;t use <code>ContinueWith</code> - the defaults are all wrong. Just use <code>await</code>.</li>
<li>Don&rsquo;t use <code>TaskFactory.ContinueWhenAny</code> - use <code>await Task.WhenAny(...)</code></li>
<li>Don&rsquo;t use <code>TaskFactory.ContinueWhenAll</code> - use <code>await Task.WhenAll(...)</code></li>
</ul>

<h2 id="starting-delegate-tasks">Starting Delegate tasks</h2>

<p><a href="http://blog.stephencleary.com/2015/02/a-tour-of-task-part-8-starting.html">The obsolete way</a>
and
<a href="http://blog.stephencleary.com/2015/03/a-tour-of-task-part-9-delegate-tasks.html">The correct way</a></p>

<ul>
<li>Don&rsquo;t use <code>Start</code>.</li>
<li>Don&rsquo;t use <code>RunSynchronously</code>. It runs on the current thread.</li>
<li>Don&rsquo;t use <code>Task.Factory.StartNew</code> unless you are doing <a href="https://msdn.microsoft.com/en-us/library/ff963551.aspx">dynamic task parallelism</a> (which is very rare)</li>
<li>DO USE <code>Task.Run</code>. Its <code>CancellationToken</code> is mostly useless, but the other overloads are good
for queueing work to the thread pool.</li>
</ul>

<h2 id="starting-promise-tasks">Starting Promise tasks</h2>

<p><a href="http://blog.stephencleary.com/2015/04/a-tour-of-task-part-10-promise-tasks.html">Original Article</a></p>

<ul>
<li><code>Task.Delay</code> is the async equivalent of <code>Thread.Sleep</code>, use it in preference. <code>Thread.Sleep</code>
actually puts the current thread to sleep for a time (which means it is not doing any useful
work). <code>Task.Delay</code> allows the thread to be used to do other work (perhaps for other tasks).</li>
<li><code>Task.FromResult</code> can be used to create a completed task with a result value.</li>
<li><code>Task.FromException</code> and <code>Task.FromCancelled</code> can be used to return completed tasks in those
states (.Net 4.6 API).</li>
</ul>

<h1 id="summary-of-stephen-cleary-s-async-intro">Summary of Stephen Cleary&rsquo;s async intro</h1>

<p><a href="http://blog.stephencleary.com/2012/02/async-and-await.html">Original Article</a></p>

<ul>
<li>Avoid <code>async void</code> methods, except for event handlers. They can&rsquo;t be awaited.</li>
<li>When you <code>await</code> a built-in awaitable, the current &ldquo;context&rdquo; is captured and later
re-applied when the rest of the async method is executed. Context means UI context, ASP.Net
request context, or thread-pool context.</li>
<li>The context overhead can be avoided by doing <code>await FooAsync(parms).ConfigureAwait(false)</code>
(you should do this by default unless you know you need the original context).</li>
</ul>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/blog/2017/spacemacs-solarized/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Spacemacs - Configuring the Solarized Theme</span>
    </a>
    
    
    <a href="/blog/2019/hugo-cheatsheet/" class="navigation-next">
      <span class="navigation-tittle">Hugo Cheatsheet</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'philipdanielscomblog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-51573023-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/rust.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/cs.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/bash.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/python.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/css.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/http.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/ini.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/javascript.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/json.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/markdown.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/sql.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/html.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/xml.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/dockerfile.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/scss.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/r.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/typescript.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/go.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/cpp.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/dos.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/plaintext.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/powershell.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/diff.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/makefile.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/lisp.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["rust, cs, bash, python, css, http, ini, javascript, json, markdown, sql, html, xml, dockerfile, scss, r, typescript, go, cpp, dos, plaintext, powershell, diff, makefile, lisp"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
